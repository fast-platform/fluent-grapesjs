!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("moment"),require("bluebird"),require("axios"),require("grapesjs")):"function"==typeof define&&define.amd?define("fluent-grapesjs",["moment","bluebird","axios","grapesjs"],t):"object"==typeof exports?exports["fluent-grapesjs"]=t(require("moment"),require("bluebird"),require("axios"),require("grapesjs")):e["fluent-grapesjs"]=t(e.moment,e.bluebird,e.axios,e.grapesjs)}(window,function(e,t,r,n){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=function(e){return e&&e.__esModule?e:{default:e}}(r(4)),o=r(5);function a(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}t.default=i.default.plugins.add("fluent-grapesjs",function(e,t){var r=e.StorageManager,i=t.pageId;if(!i)throw new Error("No page ID passed to the storage manager");if(!o.Pages||!o.Pages.remote().connector)throw new Error("Fastjs is not configured correctly");r.add("fluent-grapesjs",{load:function(e,t,r){var n=this;return a(regeneratorRuntime.mark(function a(){var s,u;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,o.Pages.remote().where("_id","=",i).first();case 3:s=n.sent,u={},e.forEach(function(e){var t=s.data[e];t&&(u[e]=t)}),t(u),n.next=12;break;case 9:n.prev=9,n.t0=n.catch(0),r(n.t0);case 12:case"end":return n.stop()}},a,n,[[0,9]])}))()},store:function(e,t,r){var s=this;return a(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,o.Pages.remote().update({_id:i,data:n({staticPage:!0},e)});case 3:t(),a.next=9;break;case 6:a.prev=6,a.t0=a.catch(0),r(a.t0);case 9:case"end":return a.stop()}},a,s,[[0,6]])}))()}})})},function(e,t){e.exports=n},function(e,t,r){"use strict";(function(e){var n,i,o,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(s,u){"object"==a(t)&&"object"==a(e)?e.exports=u(r(0),r(1),r(2)):(i=[r(0),r(1),r(2)],void 0===(o="function"==typeof(n=u)?n.apply(t,i):n)||(e.exports=o))}(0,function(e,t,r){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==(void 0===e?"undefined":a(e))&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=23)}([function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return void 0===e?"undefined":a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":a(e)},o=function(){var e=function(e,t){try{return e()}catch(e){return t}},t=function(t,r,n){var i=r;r.includes(" as ")&&(i=(r=r.split(" as "))[0]);var o=e(function(){return Array.isArray(r)&&r[1].trim()},void 0),a=i.replace(/\[/g,".").replace(/]/g,"").split(".").filter(Boolean).map(function(e){return e.trim()}).every(function(e){return!(e&&void 0===(t=t[e]))})?t:n;return{label:o||i,value:a}},r=function e(t,r,i,o,a){t&&(o=o||"",t.forEach(function(t){if(t){var s=t.columns&&Array.isArray(t.columns),u=t.rows&&Array.isArray(t.rows),c=t.components&&Array.isArray(t.components),l=!1,f=t.key?o?o+"."+t.key:t.key:"";a&&(t.parent=n({},a),delete t.parent.components,delete t.parent.componentMap,delete t.parent.columns,delete t.parent.rows),(i||t.tree||!s&&!u&&!c)&&(l=r(t,f));var d=function(){return t.key&&!["panel","table","well","columns","fieldset","tabs","form"].includes(t.type)&&(["datagrid","container","editgrid"].includes(t.type)||t.tree)?f:t.key&&"form"===t.type?f+".data":o};l||(s?t.columns.forEach(function(n){return e(n.components,r,i,d(),a?t:null)}):u?t.rows.forEach(function(n){Array.isArray(n)&&n.forEach(function(n){return e(n.components,r,i,d(),a?t:null)})}):c&&e(t.components,r,i,d(),a?t:null))}}))};return Object.freeze({cloneDeep:function(e){return JSON.parse(JSON.stringify(e))},get:e,orderBy:function(){},isEmpty:function(e){if(!e)return!0;if(Array.isArray(e)||"string"==typeof e)return!e.length;for(var t in e)if(hasOwnProperty.call(e,t))return!1;return!0},debounce:function(e,t){var r=void 0;return function(){var n=this,i=arguments;clearTimeout(r),r=setTimeout(function(){return e.apply(n,i)},t)}},getFromPath:t,deleteNulls:function e(t){var r=t,n=r instanceof Array;for(var o in r)null===r[o]?n?r.splice(o,1):delete r[o]:"object"===i(r[o])&&e(r[o]);return r},eachComponent:r,findComponents:function(e,n){var i=[];return r(e,function(e,r){(function(e,r){if("string"==typeof r)return e.key===r;var n=!1;return Object.keys(r).forEach(function(i){if(!(n=t(e,i).value===r[i]))return!1}),n})(e,n)&&(e.path=r,i.push(e))},!0),i},unixDate:function(){return Math.round(+new Date/1e3)}})}();t.default=o},function(e,t,r){e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==(void 0===e?"undefined":a(e))&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=12)}([function(e,t,r){var n=r(2),i=r(16),o=r(6),a=r(17),s=r(1),u=r(3),c=r(8),l=r(7),f=Array.prototype.concat;function d(){var e=f.apply([],arguments).filter(u);return 0===e.length?void 0:e}function h(e){if(!s(e))return e;var t=e.methods,r=e.properties,n=e.props,i=e.initializers,o=e.init,u=e.composers,f=e.deepProperties,h=e.deepProps,p=e.propertyDescriptors,v=e.staticProperties,m=e.statics,y=e.staticDeepProperties,g=e.deepStatics,b=e.configuration,w=e.conf,x=e.deepConfiguration,k=e.deepConf,O=s(n)||s(r)?l({},n,r):void 0,P=s(h)?c({},h):void 0;P=s(f)?c(P,f):P;var S=s(m)||s(v)?l({},m,v):void 0,A=s(g)?c({},g):void 0;A=s(y)?c(A,y):A;var I=e.staticPropertyDescriptors;a(e.name)&&(I=l({},I||{},{name:{value:e.name}}));var E=s(w)||s(b)?l({},w,b):void 0,R=s(k)?c({},k):void 0;R=s(x)?c(R,x):R;var C=d(o,i),j=d(u),_={};return t&&(_.methods=t),O&&(_.properties=O),C&&(_.initializers=C),j&&(_.composers=j),P&&(_.deepProperties=P),S&&(_.staticProperties=S),A&&(_.staticDeepProperties=A),p&&(_.propertyDescriptors=p),I&&(_.staticPropertyDescriptors=I),E&&(_.configuration=E),R&&(_.deepConfiguration=R),_}function p(){for(var e=arguments.length,t=[],r=0;r<e;r+=1){var i=arguments[r];t.push(o(i)?i:h(i))}return n.apply(this||v,t)}var v=i.compose({staticProperties:{create:function(){return this.apply(this,arguments)},compose:p}}),m=i.compose.staticProperties;for(var y in m)p[y]=m[y].bind(v);p.compose=p.bind(),e.exports=p},function(e,t){e.exports=function(e){var t=void 0===e?"undefined":a(e);return Boolean(e)&&("object"===t||"function"===t)}},function(e,t,r){var n=r(5),i=r(3),o=r(1),a=r(6),s=r(14),u=r(7),c=r(8),l=Array.prototype.slice;function f(e,t){var r=function e(t){var r=e.compose||{},n={__proto__:r.methods};if(c(n,r.deepProperties),u(n,r.properties),Object.defineProperties(n,r.propertyDescriptors||{}),!r.initializers||0===r.initializers.length)return n;void 0===t&&(t={});for(var o=r.initializers,a=o.length,s=0;s<a;s+=1){var f=o[s];if(i(f)){var d=f.call(n,t,{instance:n,stamp:e,args:l.apply(arguments)});n=void 0===d?n:d}}return n};e.staticDeepProperties&&c(r,e.staticDeepProperties),e.staticProperties&&u(r,e.staticProperties),e.staticPropertyDescriptors&&Object.defineProperties(r,e.staticPropertyDescriptors);var n=i(r.compose)?r.compose:t;return u(r.compose=function(){return n.apply(this,arguments)},e),r}function d(e,t,r){if(n(t)){var o=t.length,a=e[r]||[];e[r]=a;for(var s=0;s<o;s+=1){var u=t[s];i(u)&&a.indexOf(u)<0&&a.push(u)}}}function h(e,t,r,n){o(t[r])&&(o(e[r])||(e[r]={}),n(e[r],t[r]))}function p(e,t,r){h(e,t,r,c)}function v(e,t,r){h(e,t,r,u)}function m(e,t){var r=t&&t.compose||t;v(e,r,"methods"),v(e,r,"properties"),p(e,r,"deepProperties"),v(e,r,"propertyDescriptors"),v(e,r,"staticProperties"),p(e,r,"staticDeepProperties"),v(e,r,"staticPropertyDescriptors"),v(e,r,"configuration"),p(e,r,"deepConfiguration"),d(e,r.initializers,"initializers"),d(e,r.composers,"composers")}e.exports=function e(){var t={},r=[];s(this)&&(m(t,this),r.push(this));for(var i=0;i<arguments.length;i++){var o=arguments[i];s(o)&&(m(t,o),r.push(o))}var u=f(t,e),c=t.composers;if(n(c)&&c.length>0)for(var l=0;l<c.length;l+=1){var d=(0,c[l])({stamp:u,composables:r});u=a(d)?d:u}return u}},function(e,t){e.exports=function(e){return"function"==typeof e}},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==("undefined"==typeof window?"undefined":a(window))&&(r=window)}e.exports=r},function(e,t){e.exports=Array.isArray},function(e,t,r){var n=r(3);e.exports=function(e){return n(e)&&n(e.compose)}},function(e,t){e.exports=Object.assign},function(e,t,r){var n=r(15),i=r(1),o=r(5);function a(e,t){if(void 0===t)return e;if(o(t))return(o(e)?e:[]).concat(t);if(!n(t))return t;for(var r=i(e)?e:{},s=Object.keys(t),u=0;u<s.length;u+=1){var c=s[u],l=t[c];if(void 0!==l){var f=r[c],d=n(f)||o(l)?f:{};r[c]=a(d,l)}}return r}e.exports=function(e){for(var t=1;t<arguments.length;t++)e=a(e,arguments[t]);return e}},function(e,t,r){(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=o(r(0)),i=o(r(18));function o(e){return e&&e.__esModule?e:{default:e}}t.default=(0,n.default)({properties:{name:"baseModel",config:{remote:{path:void 0,token:void 0,pullForm:!1},local:{connector:"loki"},merge:{connector:"formio-loki"}}},methods:{getModelName:function(){return this.name},getFluentConfig:function(){var t=void 0;return"undefined"!=typeof window&&window&&window._FLUENT_?t=window._FLUENT_:e&&e._FLUENT_&&(t=e._FLUENT_),t},getConnector:function(e,t){return Array.isArray(e)?this.getConnectorFromArray(e,t):e instanceof Object?e:void 0},getConnectorFromArray:function(e,t){var r=this;if(1===e.length)return e[0];if(this.config&&this.config[t]&&this.config[t].connector){var n=e.find(function(e){return e.name===r.config[t].connector});if(n instanceof Object)return n}var i=e.find(function(e){return e.default});return i instanceof Object?i:void 0},remote:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.token,r=void 0===t?void 0:t,n=e.pullForm,i=void 0===n?void 0:n,o=this.getFluentConfig(),a=o&&o.connectors&&o.connectors.remote;if(!a)throw new Error("No remote connector was defined. Please define it using Fluent.config()");var s=this.getConnector(a,"remote");if(this.config.remote.token=r||this.config.remote.token,i&&(this.config.remote.pullForm=i||this.config.remote.pullForm),s)return s.connector({remoteConnection:this.config.remote,connector:s});throw new Error("No default remote connector found. Please assign one as your default in Fluent.config")},local:function(){var e=this.getFluentConfig(),t=e&&e.connectors&&e.connectors.local;if(!t)throw new Error("No local connector was defined. Please define it using Fluent.config()");var r=this.getConnector(t,"local");if(r)return r.connector({name:this.name,connector:r});throw new Error("No default local connector found. Please assign one as your default in Fluent.config")},merged:function(){var e=this.local(),t=this.remote(),r=this.getFluentConfig(),n=r&&r.connectors&&r.connectors.merge;if(!n)throw new Error("No merge connector was defined. Please define it using Fluent.config()");var i=this.getConnector(n,"merge");if(i)return i.connector({local:e,remote:t,name:this.name,connector:i});throw new Error("No default merge connector found. Please assign one as your default in Fluent.config")}}}).compose(i.default)}).call(this,r(4))},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=a(r(0)),o=a(r(11));function a(e){return e&&e.__esModule?e:{default:e}}function s(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}t.default=(0,i.default)({init:function(e){if(!Array.isArray(e))throw new Error("Collect method only accepts arrays of data");this.data=e},properties:{data:[]},methods:{get:function(){return this.data},all:function(){return this.get()},avg:function(e){return this.average(e)},average:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=[].concat(s(this.data)),r=t.reduce(function(t,r){var n=r;if(r instanceof Object){var i=o.default.getFromPath(r,e,void 0);void 0!==i&&i.value&&(n=i.value)}return t+n},0);try{return r/t.length}catch(e){throw new Error('Division between "'+r+'" and "'+t.length+'" is not valid.')}},chunks:function(e){for(var t=[].concat(s(this.data)),r=[];t.length;)r.push(t.splice(0,e));return this.data=r,this},collapse:function(){var e=[];return[].concat(s(this.data)).forEach(function(t){Array.isArray(t)?t.forEach(function(t){e.push(t)}):e.push(t)}),this.data=e,this},unChunk:function(){return this.collapse()},combine:function(e){var t=void 0;return[].concat(s(this.data)).forEach(function(r,i){r instanceof Object?(t||(t=[]),t[i]=n({},r,{_value:e[i]})):(t||(t={}),t[r]=e[i])}),this.data=t,this},concat:function(e){return this.data=[].concat(s(this.data),s(e)),this},contains:function(){var e=void 0,t=void 0,r=void 0;return 1===arguments.length?(this.isFunction(arguments.length<=0?void 0:arguments[0])&&(r=arguments.length<=0?void 0:arguments[0]),e=arguments.length<=0?void 0:arguments[0]):(e=arguments.length<=1?void 0:arguments[1],t=arguments.length<=0?void 0:arguments[0]),[].concat(s(this.data)).some(function(n,i){if(r)return!!r(n,i);var a=n;if(n instanceof Object){var s=o.default.getFromPath(n,t,void 0);s.value&&(a=s.value)}return a===e})},count:function(){return this.data.length},isFunction:function(e){return e&&"[object Function]"==={}.toString.call(e)}}})},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){var e=function(e,t){try{return e()}catch(e){return t}};return Object.freeze({get:e,getFromPath:function(t,r,n){var i=r;r.includes(" as ")&&(i=(r=r.split(" as "))[0]);var o=e(function(){return Array.isArray(r)&&r[1].trim()},void 0),a=i.replace(/\[/g,".").replace(/]/g,"").split(".").filter(Boolean).map(function(e){return e.trim()}).every(function(e){return!(e&&void 0===(t=t[e]))})?t:n;return{label:o||i,value:a}}})}();t.default=n},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Interface=t.Fluent=t.Model=void 0;var n=a(r(13)),i=a(r(9)),o=a(r(19));function a(e){return e&&e.__esModule?e:{default:e}}t.Model=i.default,t.Fluent=n.default,t.Interface=o.default},function(e,t,r){(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=a(r(0)),i=a(r(9)),o=a(r(10));function a(e){return e&&e.__esModule?e:{default:e}}function s(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var u=(0,n.default)({init:function(){this.registerGlobalVariable()},properties:{},methods:{model:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.registerModel(t),i.default.compose.apply(i.default,s(t))},extend:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.registerModel(t),i.default.compose.apply(i.default,s(t))},compose:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.registerModel(t),i.default.compose.apply(i.default,s(t))},collect:function(e){return(0,o.default)(e)},registerGlobalVariable:function(){"undefined"!=typeof window&&window&&!window._FLUENT_&&(window._FLUENT_={connectors:{},models:{}}),e&&!e._FLUENT_&&(e._FLUENT_={connectors:{},models:{}})},registerModel:function(t){var r=t&&t[0]&&t[0].properties&&t[0].properties.name?t[0].properties.name:void 0;if(r&&"baseModel"!==r){if("string"!=typeof r)throw new Error("You must assign a name to your Model when using Fluent.compose");"undefined"==typeof window?e._FLUENT_.models[r]=!0:window._FLUENT_.models[r]=!0}},config:function(t){var r=t.REMOTE_CONNECTORS,n=void 0===r?void 0:r,i=t.LOCAL_CONNECTORS,o=void 0===i?void 0:i,a=t.MERGE_CONNECTORS,s=void 0===a?void 0:a;"undefined"!=typeof window&&window&&(window._FLUENT_.connectors={local:o,remote:n,merge:s}),void 0!==e&&e&&(e._FLUENT_.connectors={local:o,remote:n,merge:s})},getConfig:function(){return"undefined"!=typeof window&&window?window._FLUENT_:void 0!==e&&e?e._FLUENT_:void 0}}})();t.default=u}).call(this,r(4))},function(e,t,r){e.exports=r(1)},function(e,t){e.exports=function(e){return Boolean(e)&&"object"==(void 0===e?"undefined":a(e))&&Object.getPrototypeOf(e)===Object.prototype}},function(e,t,r){var n=r(2);function i(e){return function(t){var r={};return r[e]=t,this&&this.compose?this.compose(r):n(r)}}var o=i("properties"),a=i("staticProperties"),s=i("configuration"),u=i("deepProperties"),c=i("staticDeepProperties"),l=i("deepConfiguration"),f=i("initializers");e.exports=n({staticProperties:{methods:i("methods"),props:o,properties:o,statics:a,staticProperties:a,conf:s,configuration:s,deepProps:u,deepProperties:u,deepStatics:c,staticDeepProperties:c,deepConf:l,deepConfiguration:l,init:f,initializers:f,composers:i("composers"),propertyDescriptors:i("propertyDescriptors"),staticPropertyDescriptors:i("staticPropertyDescriptors")}})},function(e,t){e.exports=function(e){return"string"==typeof e}},function(e,t,r){var n=r(2),i=new WeakMap,o=function(e,t){function r(){var t=i.get(this);return e.apply(t,arguments)}return Object.defineProperty(r,"name",{value:t,configurable:!0}),r};function a(e,t){var r=t.stamp.compose,n=r.deepConfiguration.Privatize.methods,a={};i.set(a,this);var s=r.methods;if(!s)return a;for(var u=Object.keys(s),c=0;c<u.length;c++){var l=u[c];n.indexOf(l)<0&&(a[l]=o(s[l],l))}if("undefined"!=typeof Symbol){var f=Symbol.for("stamp");s[f]&&(a[f]=t.stamp)}return a}var s=n({initializers:[a],deepConfiguration:{Privatize:{methods:[]}},staticProperties:{privatizeMethods:function(){for(var e=[],t=0;t<arguments.length;t++){var r=arguments[t];"string"==typeof r&&r.length>0&&e.push(r)}return(this&&this.compose?this:s).compose({deepConfiguration:{Privatize:{methods:e}}})}},composers:[function(e){var t=e.stamp.compose.initializers;t.splice(t.indexOf(a),1),t.push(a)}]});e.exports=s},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=a(r(0)),i=a(r(11)),o=a(r(10));function a(e){return e&&e.__esModule?e:{default:e}}function s(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function u(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}t.default=(0,n.default)({init:function(e){var t=e.name,r=e.remoteConnection,n=e.connector;if(!t&&!r)throw new Error("Model must have a name or path");if(!n)throw new Error("Model must have a connector. Please register one using Fluent.config");this.name=t||this.name,this.remoteConnection=r||this.remoteConnection,this.connector=n||this.connector,this.chainReference=[],this.whereArray=[],this.orWhereArray=[],this.selectArray=[],this.orderByArray=[],this.limitNumber=void 0,this.offsetNumber=void 0,this.populate=[],this.chunk=null,this.pullSize=null,this.ownerEmail=void 0},properties:{operators:["=","<",">","<=",">=","<>","!=","in","nin","like","regexp","startsWith","endsWith","contains"]},methods:{get:function(){throw new Error("get() method not implemented")},all:function(){throw new Error("all() method not implemented")},find:function(e){throw new Error("find() method not implemented")},findOne:function(){throw new Error("findOne() method not implemented")},remove:function(){throw new Error("remove() method not implemented")},softDelete:function(){throw new Error("softDelete() method not implemented")},insert:function(){throw new Error("insert() method not implemented")},update:function(){throw new Error("update() method not implemented")},clear:function(){throw new Error("clear() method not implemented")},updateOrCreate:function(){throw new Error("updateOrCreate() method not implemented")},findAndRemove:function(){throw new Error("findAndRemove() method not implemented")},owner:function(e){return this.chainReference.push({method:"owner",args:e}),this.ownerEmail=e,this},own:function(e){return this.owner(e)},first:function(){var e=this;return u(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.get();case 2:return r=t.sent,t.abrupt("return",i.default.get(function(){return r[0]},[]));case 4:case"end":return t.stop()}},t,e)}))()},collect:function(){var e=this;return u(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.get();case 2:if(r=t.sent,Array.isArray(r)){t.next=5;break}throw new Error("Collect method only accepts arrays of data");case 5:return t.abrupt("return",(0,o.default)(r));case 6:case"end":return t.stop()}},t,e)}))()},select:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t=this.prepareInput(t),this.chainReference.push({method:"select",args:t}),this.selectArray=this.selectArray.concat(t).filter(function(e,t,r){return r.indexOf(e)===t}),this},jsApplySelect:function(e){var t=this,r=Array.isArray(e)?[].concat(s(e)):[e];return this.selectArray.length>0&&(r=r.map(function(e){var r={};return t.selectArray.forEach(function(t){var n=i.default.getFromPath(e,t,void 0);void 0!==i.default.get(function(){return n.value},void 0)&&(r[n.label]=n.value)}),r})),r},offset:function(e){return this.chainReference.push({method:"offset",args:e}),this.offsetNumber=e,this},skip:function(e){return this.offset(e)},where:function(){for(var e=this,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return this.chainReference.push({method:"where",args:r}),this.whereArray=[],(r=Array.isArray(r[0])?r:[r]).forEach(function(t){if(3!==t.length)throw new Error('There where clouse is not properly formatted, expecting: ["attribute", "operator","value"] but got "'+JSON.stringify(t)+'" ');e.whereArray.push(t)}),this},andWhere:function(){for(var e=this,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return this.chainReference.push({method:"andWhere",args:r}),(r=Array.isArray(r[0])?r:[r]).forEach(function(t){if(3!==t.length)throw new Error('There where clouse is not properly formatted, expecting: ["attribute", "operator","value"] but got "'+JSON.stringify(t)+'" ');e.whereArray.push(t)}),this},orWhere:function(){for(var e=this,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return this.chainReference.push({method:"orWhere",args:r}),(r=Array.isArray(r[0])?r:[r]).forEach(function(t){if(3!==t.length)throw new Error('There orWhere clouse is not properly formatted, expecting: ["attribute", "operator","value"] but got "'+JSON.stringify(t)+'" ');e.orWhereArray.push(t)}),this},limit:function(e){return this.chainReference.push({method:"limit",args:e}),this.limitNumber=e,this},take:function(e){return this.limit(e)},pluck:function(e){var t=this;return u(regeneratorRuntime.mark(function r(){var n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t.chainReference.push({method:"pluck",args:e}),r.next=3,t.get();case 3:return n=(n=r.sent).map(function(t){var r=i.default.getFromPath(t,e,void 0);if(void 0!==r.value)return r.value}),r.abrupt("return",n);case 6:case"end":return r.stop()}},r,t)}))()},orderBy:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.chainReference.push({method:"orderBy",args:t}),this.orderByArray=t,this},jsApplyOrderBy:function(e){var t=[].concat(s(e));if(0===this.orderByArray.length)return t;var r=this.orderByArray[0];if(this.selectArray.length>0&&(r.includes(".")||r.includes("[")))throw new Error('Cannot orderBy nested attribute "'+r+'" when using Select. You must rename the attribute');var n=this.orderByArray[1],o=this.orderByArray[2];return o||(o="string"),t.sort(function(e,t){var a=i.default.getFromPath(e,r,void 0).value,s=i.default.getFromPath(t,r,void 0).value;if(void 0===a||void 0===s)throw new Error('Cannot order by property "'+r+'" not all values have this property');return o.includes("string")||o.includes("number")?"asc"===n?a>s?1:a<s?-1:0:a>s?-1:a<s?1:0:o.includes("date")?"asc"===n?new Date(a)-new Date(s):new Date(s)-new Date(a):void 0})},prepareInput:function(e){var t=[];return e.forEach(function(e){var r=Array.isArray(e)?e:e.split(",");r=r.map(function(e){return e.trim()}),t=t.concat(r)}),t.filter(function(e,t,r){return r.indexOf(e)===t}),t},ArrayInsert:function(e,t){var r=this;return u(regeneratorRuntime.mark(function n(){var i,o,a,s,u,c,l,f;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:i=1,o=e.length,a=!0,s=!1,u=void 0,n.prev=5,c=e[Symbol.iterator]();case 7:if(a=(l=c.next()).done){n.next=26;break}return f=l.value,t&&t.showProgress&&console.log("Inserting "+i+" of "+o),n.prev=10,n.next=13,r.insert(f,t);case 13:n.sent,t&&t.showProgress&&console.log("Element "+i+" inserted"),i++,n.next=23;break;case 18:n.prev=18,n.t0=n.catch(10),console.log("ERROR - Element "+i+" - "+JSON.stringify(f)+" could not be inserted"),console.log(n.t0),i++;case 23:a=!0,n.next=7;break;case 26:n.next=32;break;case 28:n.prev=28,n.t1=n.catch(5),s=!0,u=n.t1;case 32:n.prev=32,n.prev=33,!a&&c.return&&c.return();case 35:if(n.prev=35,!s){n.next=38;break}throw u;case 38:return n.finish(35);case 39:return n.finish(32);case 40:case"end":return n.stop()}},n,r,[[5,28,32,40],[10,18],[33,,35,39]])}))()}}})}])},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=r(1),o=s(r(0)),a=s(r(3));function s(e){return e&&e.__esModule?e:{default:e}}function u(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}t.default=i.Fluent.model({properties:{name:"Configuration",config:{remote:{connector:"formioConfig",token:""}}},methods:{set:function(e){var t=this;return u(regeneratorRuntime.mark(function r(){var n=e.appConf,i=e.forceOnline;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}return e.abrupt("return",t.setOffline({appConf:n}));case 2:return e.abrupt("return",t.setOnline({appConf:n}));case 3:case"end":return e.stop()}},r,t)}))()},setOffline:function(e){var t=this;return u(regeneratorRuntime.mark(function r(){var i,o,s,u=e.appConf;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.local().first();case 2:if(i=e.sent,o=t.getConfigDate(i),s=u.offlineFiles.lastUpdated.date,!(o>s)){e.next=7;break}return e.abrupt("return",i);case 7:if(!i){e.next=10;break}return e.next=10,t.local().clear({sure:!0});case 10:return e.abrupt("return",t.local().insert(n({},u.offlineFiles.Configuration.data,{fastUpdated:(0,a.default)().unix()})));case 11:case"end":return e.stop()}},r,t)}))()},setOnline:function(e){var t=this;return u(regeneratorRuntime.mark(function r(){var i,o;return e.appConf,regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.local().first();case 2:return i=e.sent,e.next=5,t.remote().first();case 5:if(o=e.sent,i||o){e.next=8;break}throw new Error("Application is not connected to internet, or the configuration file cannot be pulled");case 8:if(o){e.next=10;break}return e.abrupt("return",i);case 10:if(!i){e.next=13;break}return e.next=13,t.local().clear({sure:!0});case 13:return e.abrupt("return",t.local().insert(n({},o.data,{fastUpdated:(0,a.default)().unix()})));case 14:case"end":return e.stop()}},r,t)}))()},getConfigDate:function(e){return o.default.get(function(){return e.fastUpdated},0)}}}).compose(i.Fluent.privatize).privatizeMethods("setOnlineConfig","setOfflineConfig","getConfigDate","assingGlobalVariable","getRemote")()},function(t,r){t.exports=e},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(3)),i=u(r(0)),o=r(1),a=u(r(25)),s=u(r(2));function u(e){return e&&e.__esModule?e:{default:e}}function c(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}t.default=o.Fluent.model({properties:{name:"Form",config:{remote:{path:"form",pullForm:!0}}},methods:{getModel:function(e){var t=e.path;return o.Fluent.model({properties:{config:{remote:{path:t}}}})()},find:function(e){var t=e.path;return this.local().where("data.path","=",t).first()},cardFormattedForms:function(e){var t=this;return c(regeneratorRuntime.mark(function r(){var i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.local().get();case 2:return i={cards:i=(i=(i=(i=r.sent).filter(function(e){return e.data.tags.indexOf("visible")>-1})).sort(function(e,t){return(e=e.data.title)>(t=t.data.title)?1:e<t?-1:0})).map(function(t){return{title:t.data.title,tags:t.data.tags,customIcon:!0,icon:"create"===e?"statics/customSVG/startSurvey.svg":"statics/customSVG/collectedData.svg",subtitle:"Last updated: "+(0,n.default)(t.data.modified).fromNow(),actions:[{text:"create"===e?"Start":"View data",target:"form",view:e,path:t.data.path}]}})},r.abrupt("return",i);case 8:case"end":return r.stop()}},r,t)}))()},FormLabels:function(e,t){var r=this;return c(regeneratorRuntime.mark(function e(){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.local().get();case 2:return n=e.sent,e.abrupt("return",a.default.get(n,t));case 4:case"end":return e.stop()}},e,r)}))()},getUpdatedAt:function(e){return i.default.get(function(){return e[0].fastUpdated},0)},setOffline:function(e){var t=this;return c(regeneratorRuntime.mark(function r(){var o,a,u,l,f=e.appConf;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.local().get();case 2:return o=e.sent,a=t.getUpdatedAt(o),e.next=6,s.default.local().first();case 6:if(u=e.sent,l=i.default.get(function(){return f.offlineFiles.Forms}),!(u.fastUpdated<a)){e.next=10;break}return e.abrupt("return",o);case 10:if(!o){e.next=13;break}return e.next=13,t.local().clear({sure:!0});case 13:return l.forEach(function(){var e=c(regeneratorRuntime.mark(function e(r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.local().insert({data:r,fastUpdated:(0,n.default)().unix()});case 2:case"end":return e.stop()}},e,t)}));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",l);case 15:case"end":return e.stop()}},r,t)}))()},setOnline:function(){var e=this;return c(regeneratorRuntime.mark(function t(){var r,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.remote().get();case 2:if(r=t.sent,o=(0,n.default)().unix(),!r||i.default.isEmpty(r)){t.next=8;break}return t.next=7,e.local().clear({sure:!0});case 7:r.forEach(function(){var t=c(regeneratorRuntime.mark(function t(r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.local().insert({data:r,fastUpdated:o});case 2:case"end":return t.stop()}},t,e)}));return function(e){return t.apply(this,arguments)}}());case 8:case"end":return t.stop()}},t,e)}))()},set:function(e){var t=this;return c(regeneratorRuntime.mark(function r(){var n=e.appConf,i=e.forceOnline;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}return e.abrupt("return",t.setOffline({appConf:n}));case 2:return e.abrupt("return",t.setOnline());case 3:case"end":return e.stop()}},r,t)}))()},getFastTableTemplates:function(e){var t=this;return c(regeneratorRuntime.mark(function r(){var n,o,a=e.path;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.local().where("data.path","=",a).first();case 2:return n=e.sent,o=[],i.default.eachComponent(n.data.components,function(e){e.properties&&e.properties.FAST_TABLE_TEMPLATE&&o.push({key:e.key,template:e.properties.FAST_TABLE_TEMPLATE})}),e.abrupt("return",o);case 6:case"end":return e.stop()}},r,t)}))()}}})()},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=a(r(9)),i=a(r(7)),o=a(r(13));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(){var e="undefined"==typeof window||!window||!window.navigator||window.navigator.onLine;return Object.freeze({isOnline:function(){return new i.default(function(e,t){o.default.get("https://yesno.wtf/api").then(function(t){e(!0)}).catch(function(t){e(!1)})})},initEventListeners:function(){n.default.listen({name:"online",callback:function(){console.log("App is now online"),e||(e=!0,n.default.emit({name:"FAST:CONNECTION:ONLINE",data:e,text:"Application is now online"}))}}),n.default.listen({name:"offline",callback:function(){console.log("App is now offline"),e&&(e=!1,n.default.emit({name:"FAST:CONNECTION:OFFLINE",data:e,text:"Application is now offline"}))}})}})}();t.default=s},function(e,t,r){function n(e,t){return e.then(function(e){return[null,e]}).catch(function(e){return t&&Object.assign(e,t),[e,void 0]})}r.r(t),r.d(t,"to",function(){return n}),t.default=n},function(e,r){e.exports=t},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=l(r(14)),o=l(r(3)),a=l(r(0)),s=l(r(4)),u=r(1),c=l(r(30));function l(e){return e&&e.__esModule?e:{default:e}}function f(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function d(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}t.default=u.Fluent.model({properties:{name:"Submission",config:{remote:void 0}},init:function(e){var t=e.path;this.path=t,this.config={remote:{path:t}}},methods:{form:function(){var e=this;return d(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},t,e)}))()},getUnsync:function(){var e=this;return d(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.local().where("sync","=",!1).andWhere("draft","=",!1).andWhere("syncError","=",!1).owner(i.default.email()).orderBy("created","desc","date").get();case 2:return t.t0=function(e){return!e.queuedForSync},r=t.sent.filter(t.t0),t.abrupt("return",r);case 5:case"end":return t.stop()}},t,e)}))()},showView:function(e){var t=this;return d(regeneratorRuntime.mark(function r(){var i,a,u,l=e.from,d=e.limit,h=e.owner;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.default.getTableView(t.path);case 2:if(e.t0=function(e){return"data."+e.path+" as "+e.path},i=e.sent.map(e.t0),i=[].concat(f(i),["_id","created","modified","syncError","draft","sync"]),a=[],"remote"!==l){e.next=12;break}return e.next=9,t.remote().select(i).limit(d).get();case 9:a=e.sent,e.next=15;break;case 12:return e.next=14,t.merged().select(i).limit(d).owner(h).get();case 14:a=e.sent;case 15:return e.next=17,s.default.getFastTableTemplates({path:t.path});case 17:return u=e.sent,a=(a=a.map(function(e){var t={_id:e._id,status:!1===e.sync?"offline":"online",draft:e.draft,HumanUpdated:Number.isInteger(e.modified)?o.default.unix(e.modified).fromNow():(0,o.default)(e.modified).fromNow(),syncError:!!e.syncError&&e.syncError,updated:Number.isInteger(e.modified)?e.modified:(0,o.default)(e.modified).unix()};return u.forEach(function(t){var r=new Function("value","data",t.template);try{e[t.key]=r(e[t.key],e)}catch(e){console.log("There is an error in one of your calculations",e)}}),n({},t,e)})).sort(function(e,t){return(e=new Date(e.updated))>(t=new Date(t.updated))?-1:e<t?1:0}),e.abrupt("return",a);case 21:case"end":return e.stop()}},r,t)}))()},getParallelParticipants:function(e){var t=this;return d(regeneratorRuntime.mark(function r(){var n,i,o,s;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.local().where("_id","=",e).get();case 2:return n=(n=r.sent)[0],i=(i=a.default.get(function(){return n.data.data.parallelSurvey}))&&"[object Object]"!==i?JSON.parse(i).groupId:void 0,r.next=8,t.local().where("path","=",t.path).get();case 8:return o=r.sent,s=(s=(s=o.filter(function(e){var t=a.default.get(function(){return e.data.data.parallelSurvey});return(t=t&&"[object Object]"!==t?JSON.parse(t).groupId:void 0)&&t===i})).map(function(e){e.data.data.parallelSurvey})).map(function(e){return JSON.parse(e)}),r.abrupt("return",s);case 13:case"end":return r.stop()}},r,t)}))()},getParallelSurvey:function(e){var t=a.default.get(function(){return e.data.data.paraparallelSurvey})||a.default.get(function(){return e.data.parallelSurvey});return t&&"[object Object]"!==t?JSON.parse(t):void 0},setParallelSurvey:function(e){return JSON.stringify(e)},getGroups:function(e){var t=this;return d(regeneratorRuntime.mark(function r(){var n,i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.local().find();case 2:return n=r.sent,n=e?n.filter(function(t){return t.data.formio.formId===e}):n,i=(i=n.map(function(e){return t.local().getParallelSurvey(e)?{groupId:t.local().getParallelSurvey(e).groupId,groupName:t.local().getParallelSurvey(e).groupName}:void 0})).filter(function(e){return void 0!==e}),r.abrupt("return",a.default.uniqBy(i,"groupId"));case 7:case"end":return r.stop()}},r,t)}))()},getGroup:function(e){var t=this;return d(regeneratorRuntime.mark(function r(){var n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.local().getGroups();case 2:return n=(n=r.sent).filter(function(t){return t.groupId===e}),r.abrupt("return",n[0]);case 5:case"end":return r.stop()}},r,t)}))()},removeFromGroup:function(e){var t=this;return d(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,t)}))()},assingToGroup:function(e,t){var r=this;return d(regeneratorRuntime.mark(function i(){var o,a,s,u;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,r.local().getGroup(t[0]);case 2:return o=i.sent,i.next=5,r.local().get(e);case 5:return a=i.sent,s=r.local().getParallelSurvey(a),u=n({},s,{groupId:o.groupId,groupName:o.groupName}),a.data.data.parallelSurvey=r.local().setParallelSurvey(u),i.next=11,r.local().update(a);case 11:case"end":return i.stop()}},i,r)}))()}}})},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=Object.freeze({emit:function(e){var t=e.name,r=e.data,n=e.text;if(!t)throw new Error("Event must have a name.");if(!r)throw new Error("Event must have data.");if(!n)throw new Error("Event must have a text.");var i=function(e,t){var r=document.createEvent("CustomEvent");return t=t||{bubbles:!1,cancelable:!1,detail:void 0},r.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),r}(t,{detail:{data:r,text:n}});window.dispatchEvent(i)},listen:function(e){var t=e.name,r=e.callback;if(!t)throw new Error("Listener must have a name.");if(!r)throw new Error("Listener must have a callback.");window.addEventListener(t,r)},remove:function(e){var t=e.name,r=e.callback;if(!t)throw new Error("Listener must have a name to detach");if(!r)throw new Error("Listener must have a callback to detach");window.removeEventListener(t,r)}});t.default=n},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=u(r(0)),o=r(1),a=u(r(2)),s=u(r(3));function u(e){return e&&e.__esModule?e:{default:e}}function c(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}t.default=o.Fluent.model({properties:{name:"Translation",config:{remote:{path:"translations"}}},methods:{getFormTranslations:function(){var e=this;return c(regeneratorRuntime.mark(function t(){var r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={},t.next=3,e.local().first();case 3:return n=t.sent,n=i.default.get(function(){return n.data},{}),Object.keys(n).forEach(function(e){"type"!==e&&(r[e]=n[e])}),t.abrupt("return",r);case 7:case"end":return t.stop()}},t,e)}))()},supportedLanguages:function(){var e=this;return c(regeneratorRuntime.mark(function t(){var r,n,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.local().get();case 2:if(0!==(r=t.sent).length){t.next=5;break}return t.abrupt("return",[]);case 5:return n=e.getIsoLanguages(),o=[],r=i.default.get(function(){return r[0].data},[]),Object.keys(r).forEach(function(e){var t=n.find(function(t){return t.code===e});t&&o.push(t)}),o=o.sort(function(e,t){return(e=e.label)>(t=t.label)?1:e<t?-1:0}),t.abrupt("return",o);case 11:case"end":return t.stop()}},t,e)}))()},getIsoLanguages:function(){return r(26)},getLocalizationDate:function(e){return i.default.get(function(){return e[0].fastUpdated},0)},set:function(e){var t=this;return c(regeneratorRuntime.mark(function r(){var n=e.appConf,i=e.forceOnline;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}return e.abrupt("return",t.setOffline({appConf:n}));case 2:return e.abrupt("return",t.setOnline({appConf:n}));case 3:case"end":return e.stop()}},r,t)}))()},setOffline:function(e){var t=this;return c(regeneratorRuntime.mark(function r(){var n,i,o,s,u,c=e.appConf;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.local().get();case 2:return n=e.sent,i=t.getLocalizationDate(n),e.next=6,a.default.local().first();case 6:if(o=e.sent,s=c.offlineFiles.Translations,!(o.fastUpdated<i)){e.next=10;break}return e.abrupt("return",n[0].data);case 10:return e.next=12,t.process(s);case 12:return u=e.sent,e.abrupt("return",t.storeTranslations(u));case 14:case"end":return e.stop()}},r,t)}))()},setOnline:function(e){var t=this;return c(regeneratorRuntime.mark(function r(){var n,i;return e.appConf,regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.local().get();case 2:return n=e.sent,e.next=5,t.remote().limit(5e4).get();case 5:if(!(i=e.sent)){e.next=14;break}return e.next=9,t.process(i);case 9:return i=e.sent,e.next=12,t.storeTranslations(i);case 12:return i=e.sent,e.abrupt("return",i);case 14:if(!(n.length>0&&n[0].data)){e.next=16;break}return e.abrupt("return",n[0].data);case 16:case"end":return e.stop()}},r,t)}))()},storeTranslations:function(e){var t=this;return c(regeneratorRuntime.mark(function r(){var n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t.local().clear({sure:!0}),r.next=3,t.local().insert({data:e,fastUpdated:(0,s.default)().unix()});case 3:return n=r.sent,r.abrupt("return",n.data);case 5:case"end":return r.stop()}},r,t)}))()},process:function(e){var t=this;return c(regeneratorRuntime.mark(function r(){var n,i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.getIsoLanguages(),(i={}).label={},n.forEach(function(t){e.forEach(function(e){e.data&&e.data[t.code]&&(i[t.code]||(i[t.code]={}),i[t.code][e.data.label]=e.data[t.code]),e.data&&e.data.label&&(i.label[e.data.label]=e.data.label)})}),r.abrupt("return",i);case 5:case"end":return r.stop()}},r,t)}))()},updateLabel:function(e,t){var r=this;return c(regeneratorRuntime.mark(function i(){var o,a,s,u;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,r.remote().where("data.label","=",e).first();case 2:return o=i.sent,a=o._id,s=n({},o.data,t),i.next=7,r.remote().update({_id:a,data:s});case 7:return u=i.sent,i.abrupt("return",u);case 9:case"end":return i.stop()}},i,r)}))()},createTranslation:function(e){var t=this;return c(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t.remote().insert({data:{en:e,label:e}}));case 1:case"end":return r.stop()}},r,t)}))()}}})()},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=r(1),a=l(r(0)),s=l(r(2)),u=l(r(6)),c=l(r(3));function l(e){return e&&e.__esModule?e:{default:e}}function f(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}t.default=o.Fluent.model({properties:{name:"Pages",config:{remote:{path:"fast-app-pages",token:void 0}}},methods:{set:function(e){var t=this;return f(regeneratorRuntime.mark(function r(){var n=e.appConf,i=e.forceOnline;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}return e.abrupt("return",t.setOffline({appConf:n}));case 2:return e.abrupt("return",t.setOnline());case 3:case"end":return e.stop()}},r,t)}))()},setOffline:function(e){var t=this;return f(regeneratorRuntime.mark(function r(){var n,o,u,l,f=e.appConf;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.local().first();case 2:return n=e.sent,o=t.getUpdatedDate(n),e.next=6,s.default.local().first();case 6:if(u=e.sent,l=a.default.get(function(){return f.offlineFiles.Pages[0].data}),!(u.fastUpdated<o)){e.next=10;break}return e.abrupt("return",a.default.get(function(){return n.data}));case 10:if(!n){e.next=13;break}return e.next=13,t.local().clear({sure:!0});case 13:return e.abrupt("return",t.local().insert(i({},l,{fastUpdated:(0,c.default)().unix()})));case 14:case"end":return e.stop()}},r,t)}))()},setOnline:function(){var e=this;return f(regeneratorRuntime.mark(function t(){var r,o,s,l,f;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.local().first();case 2:return r=t.sent,t.next=5,(0,u.default)(e.remote().first());case 5:if(o=t.sent,s=n(o,2),l=s[0],f=s[1],!l){t.next=12;break}throw console.log(l),new Error("Could not get remote Pages.");case 12:if(!(f=a.default.get(function(){return f.data}))||a.default.isEmpty(f)){t.next=18;break}if(!r){t.next=17;break}return t.next=17,e.local().clear({sure:!0});case 17:return t.abrupt("return",e.local().insert(i({},f,{fastUpdated:(0,c.default)().unix()})));case 18:return t.abrupt("return",r);case 19:case"end":return t.stop()}},t,e)}))()},getUpdatedDate:function(e){return a.default.get(function(){return e.fastUpdated},0)}}})()},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=f(r(13)),o=f(r(2)),a=f(r(0)),s=r(1),u=f(r(5)),c=f(r(6)),l=f(r(4));function f(e){return e&&e.__esModule?e:{default:e}}function d(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}t.default=s.Fluent.model({properties:{name:"User",config:{remote:{path:"user",token:void 0}}},methods:{storeLocally:function(e){var t=this;return d(regeneratorRuntime.mark(function r(){var i,o,s,f,d;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.local().where("data.email","=",e.data.email).first();case 2:if(i=r.sent,e=a.default.deleteNulls(e),!i||a.default.isEmpty(i)){r.next=7;break}throw new Error("The user email is already taken");case 7:if(!u.default.isOnline()){r.next=17;break}return r.next=10,(0,c.default)(l.default.getModel({path:"userregister"}).remote().insert(e));case 10:if(o=r.sent,s=n(o,2),f=s[0],d=s[1],!f){r.next=16;break}throw new Error("The user email is already taken");case 16:return r.abrupt("return",t.local().insert(d));case 17:return r.abrupt("return",t.local().insert(e));case 18:case"end":return r.stop()}},r,t)}))()},updateUser:function(e){var t=this;return d(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.local().where("data.email","=",e.data.email).pluck("_id");case 2:return r.sent.forEach(function(){var e=d(regeneratorRuntime.mark(function e(r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.local().remove(r);case 2:case"end":return e.stop()}},e,t)}));return function(t){return e.apply(this,arguments)}}()),e=a.default.deleteNulls(e),r.abrupt("return",t.local().insert(e));case 6:case"end":return r.stop()}},r,t)}))()},login:function(e){var t=this;return d(regeneratorRuntime.mark(function r(){var n,a=e.credentials,s=e.role;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.default.local().first();case 2:return n=e.sent.APP_URL,n+="admin"===s?"/admin/login":"/user/login",e.abrupt("return",i.default.post(n,{data:a}));case 5:case"end":return e.stop()}},r,t)}))()}}})()},function(e,t){e.exports=r},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=l(r(2)),i=l(r(17)),o=l(r(12)),a=l(r(5)),s=l(r(15)),u=l(r(7)),c=l(r(0));function l(e){return e&&e.__esModule?e:{default:e}}function f(e){return function(){var t=e.apply(this,arguments);return new u.default(function(e,r){return function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return u.default.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var d=function(){var e=function(){var e=f(regeneratorRuntime.mark(function e(t){var r,a,s,u,c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.username,a=t.password,e.next=3,n.default.local().first();case 3:return s=e.sent,u=(0,i.default)(a,s.MD5_KEY),e.next=7,o.default.local().where("data.username","=",r).get();case 7:if(c=e.sent,l=c&&c[0]?c[0]:void 0){e.next=11;break}throw new Error;case 11:if(l.data.hashedPassword===u){e.next=14;break}throw new Error;case 14:return e.abrupt("return",l);case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t=function(){var e=f(regeneratorRuntime.mark(function e(t,r,n){var i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.default.login({credentials:t,role:n});case 2:return i=e.sent,a=i.data,e.next=6,o.default.updateUser(a);case 6:return e.abrupt("return",i);case 7:case"end":return e.stop()}},e,void 0)}));return function(t,r,n){return e.apply(this,arguments)}}(),r=function(){var r=f(regeneratorRuntime.mark(function r(n,i,o){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,a.default.isOnline();case 2:if(!r.sent){r.next=5;break}return r.abrupt("return",t(n,i,o));case 5:return r.abrupt("return",e(n,i));case 6:case"end":return r.stop()}},r,this)}));return function(e,t,n){return r.apply(this,arguments)}}(),l=function(e){var t=JSON.parse(localStorage.getItem("authUser"));return void 0!==(t=null!==t&&t).rolesNames.find(function(t){return t.title===e})},h=function(){var e=f(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&!c.default.isEmpty(t)){e.next=2;break}return e.abrupt("return",!0);case 2:return e.next=4,s.default.local().first();case 4:return r=e.sent,n=t.reduce(function(e,t){return Object.keys(r).forEach(function(n){r[n]&&r[n]._id&&r[n]._id===t&&e.push(r[n].title)}),e},[]),e.abrupt("return",n.some(function(e){return l(e)||"Authenticated"===e}));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),p=function(){var e=f(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,localStorage.removeItem("authUser");case 2:return e.next=4,localStorage.removeItem("formioToken");case 4:return e.next=6,localStorage.removeItem("formioUser");case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}();return Object.freeze({user:function(){try{var e=JSON.parse(localStorage.getItem("authUser"));return null!==e&&e}catch(e){return localStorage.removeItem("authUser"),!1}},email:function(){var e="";return d.user()&&d.user().data&&d.user().data.email?e=d.user().data.email:d.user()&&d.user().email&&(e=d.user().email),e},hasRoleIn:function(e){return!(e&&!c.default.isEmpty(e))||e.some(function(e){return l(e)||"Authenticated"===e})},hasRoleIdIn:h,hasRole:l,check:function(){var e=JSON.parse(localStorage.getItem("authUser"));return!!e&&!!e.x_jwt_token},logOut:p,attempt:function(e,t,n){var i=this;return n=n||"user",new u.default(function(o,a){r(e,t,n).then(function(){var e=f(regeneratorRuntime.mark(function e(t){var r,n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.headers||{},(n=t.data).x_jwt_token=r["x-jwt-token"],localStorage.setItem("authUser",JSON.stringify(n)),localStorage.setItem("formioToken",r["x-jwt-token"]),e.next=7,s.default.local().first();case 7:a=e.sent,n.rolesNames=[],Object.keys(a).forEach(function(e){"$loki"!==e&&"_id"!==e&&"meta"!==e&&n.roles&&-1!==n.roles.indexOf(a[e]._id)&&n.rolesNames.push(a[e])}),localStorage.setItem("authUser",JSON.stringify(n)),o(n);case 12:case"end":return e.stop()}},e,i)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){console.log("There was an error over here!"),a(e)})})}})}();t.default=d},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=r(1),o=c(r(0)),a=c(r(5)),s=c(r(6)),u=c(r(3));function c(e){return e&&e.__esModule?e:{default:e}}function l(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}t.default=i.Fluent.model({properties:{name:"Role",config:{remote:{path:"access",token:void 0,pullForm:!0}}},methods:{set:function(e){var t=this;return l(regeneratorRuntime.mark(function r(){var n=e.url,i=e.appConf,o=e.forceOnline;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o){e.next=2;break}return e.abrupt("return",t.setOffline({appConf:i}));case 2:return e.abrupt("return",t.setOnline({url:n}));case 3:case"end":return e.stop()}},r,t)}))()},getRolesDate:function(e){return o.default.get(function(){return e.fastUpdated},0)},setOnline:function(){var e=this;return l(regeneratorRuntime.mark(function t(){var r,i,c,l,f,d;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=void 0,i=void 0,t.next=4,e.local().first();case 4:return c=t.sent,t.next=7,a.default.isOnline();case 7:if(!t.sent){t.next=17;break}return t.next=11,(0,s.default)(e.remote().first());case 11:if(l=t.sent,f=n(l,2),r=f[0],i=f[1],!r){t.next=17;break}throw new Error(r);case 17:if(!(i=o.default.get(function(){return i.roles}))){t.next=27;break}if(!c){t.next=22;break}return t.next=22,e.local().clear();case 22:return i.fastUpdated=(0,u.default)().unix(),t.next=25,e.local().insert(i);case 25:return d=t.sent,t.abrupt("return",d);case 27:return t.abrupt("return",c);case 28:case"end":return t.stop()}},t,e)}))()},setOffline:function(e){var t=this;return l(regeneratorRuntime.mark(function r(){var n,i,o,a=e.appConf;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.local().first();case 2:if(n=e.sent,i=t.getRolesDate(n),!(a.offlineFiles.lastUpdated.date>i)&&n){e.next=13;break}if(!n){e.next=9;break}return e.next=9,t.local().clear();case 9:return e.next=11,t.local().insert(a.offlineFiles.Roles);case 11:return o=e.sent,e.abrupt("return",o);case 13:return e.abrupt("return",n);case 14:case"end":return e.stop()}},r,t)}))()}}})()},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=c(r(12)),o=c(r(14)),a=c(r(8)),s=c(r(31)),u=c(r(19));function c(e){return e&&e.__esModule?e:{default:e}}function l(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"now",value:function(){var t=l(regeneratorRuntime.mark(function t(r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.syncUsers();case 2:if(!o.default.check()){t.next=5;break}return t.next=5,e.syncSubmission(r);case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"syncSubmission",value:function(){var t=l(regeneratorRuntime.mark(function t(){var r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.areUsersSynced();case 2:if(t.sent){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,(0,a.default)().getUnsync();case 7:return r=t.sent,t.next=10,u.default.isSyncing();case 10:n=t.sent,r.length>0&&!n&&s.default.send(r);case 12:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"getUsersToSync",value:function(){var e=l(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.default.local().where("sync","=",!1).andWhere("queuedForSync","=",!1).andWhere("syncError","=",!1).get();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"areUsersSynced",value:function(){var t=l(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getUsersToSync();case 2:return r=t.sent,t.abrupt("return",!!r&&Array.isArray(r)&&0===r.length);case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"syncUsers",value:function(){var t=l(regeneratorRuntime.mark(function t(){var r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getUsersToSync();case 2:return r=t.sent,t.next=5,u.default.isSyncing();case 5:n=t.sent,Array.isArray(r)&&r.length>0&&!n&&s.default.syncUsers(r);case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}]),e}();t.default=f},function(e,t,r){!function(){var t=r(28),n=r(18).utf8,i=r(29),o=r(18).bin,a=function e(r,a){r.constructor==String?r=a&&"binary"===a.encoding?o.stringToBytes(r):n.stringToBytes(r):i(r)?r=Array.prototype.slice.call(r,0):Array.isArray(r)||(r=r.toString());for(var s=t.bytesToWords(r),u=8*r.length,c=1732584193,l=-271733879,f=-1732584194,d=271733878,h=0;h<s.length;h++)s[h]=16711935&(s[h]<<8|s[h]>>>24)|4278255360&(s[h]<<24|s[h]>>>8);s[u>>>5]|=128<<u%32,s[14+(u+64>>>9<<4)]=u;var p=e._ff,v=e._gg,m=e._hh,y=e._ii;for(h=0;h<s.length;h+=16){var g=c,b=l,w=f,x=d;l=y(l=y(l=y(l=y(l=m(l=m(l=m(l=m(l=v(l=v(l=v(l=v(l=p(l=p(l=p(l=p(l,f=p(f,d=p(d,c=p(c,l,f,d,s[h+0],7,-680876936),l,f,s[h+1],12,-389564586),c,l,s[h+2],17,606105819),d,c,s[h+3],22,-1044525330),f=p(f,d=p(d,c=p(c,l,f,d,s[h+4],7,-176418897),l,f,s[h+5],12,1200080426),c,l,s[h+6],17,-1473231341),d,c,s[h+7],22,-45705983),f=p(f,d=p(d,c=p(c,l,f,d,s[h+8],7,1770035416),l,f,s[h+9],12,-1958414417),c,l,s[h+10],17,-42063),d,c,s[h+11],22,-1990404162),f=p(f,d=p(d,c=p(c,l,f,d,s[h+12],7,1804603682),l,f,s[h+13],12,-40341101),c,l,s[h+14],17,-1502002290),d,c,s[h+15],22,1236535329),f=v(f,d=v(d,c=v(c,l,f,d,s[h+1],5,-165796510),l,f,s[h+6],9,-1069501632),c,l,s[h+11],14,643717713),d,c,s[h+0],20,-373897302),f=v(f,d=v(d,c=v(c,l,f,d,s[h+5],5,-701558691),l,f,s[h+10],9,38016083),c,l,s[h+15],14,-660478335),d,c,s[h+4],20,-405537848),f=v(f,d=v(d,c=v(c,l,f,d,s[h+9],5,568446438),l,f,s[h+14],9,-1019803690),c,l,s[h+3],14,-187363961),d,c,s[h+8],20,1163531501),f=v(f,d=v(d,c=v(c,l,f,d,s[h+13],5,-1444681467),l,f,s[h+2],9,-51403784),c,l,s[h+7],14,1735328473),d,c,s[h+12],20,-1926607734),f=m(f,d=m(d,c=m(c,l,f,d,s[h+5],4,-378558),l,f,s[h+8],11,-2022574463),c,l,s[h+11],16,1839030562),d,c,s[h+14],23,-35309556),f=m(f,d=m(d,c=m(c,l,f,d,s[h+1],4,-1530992060),l,f,s[h+4],11,1272893353),c,l,s[h+7],16,-155497632),d,c,s[h+10],23,-1094730640),f=m(f,d=m(d,c=m(c,l,f,d,s[h+13],4,681279174),l,f,s[h+0],11,-358537222),c,l,s[h+3],16,-722521979),d,c,s[h+6],23,76029189),f=m(f,d=m(d,c=m(c,l,f,d,s[h+9],4,-640364487),l,f,s[h+12],11,-421815835),c,l,s[h+15],16,530742520),d,c,s[h+2],23,-995338651),f=y(f,d=y(d,c=y(c,l,f,d,s[h+0],6,-198630844),l,f,s[h+7],10,1126891415),c,l,s[h+14],15,-1416354905),d,c,s[h+5],21,-57434055),f=y(f,d=y(d,c=y(c,l,f,d,s[h+12],6,1700485571),l,f,s[h+3],10,-1894986606),c,l,s[h+10],15,-1051523),d,c,s[h+1],21,-2054922799),f=y(f,d=y(d,c=y(c,l,f,d,s[h+8],6,1873313359),l,f,s[h+15],10,-30611744),c,l,s[h+6],15,-1560198380),d,c,s[h+13],21,1309151649),f=y(f,d=y(d,c=y(c,l,f,d,s[h+4],6,-145523070),l,f,s[h+11],10,-1120210379),c,l,s[h+2],15,718787259),d,c,s[h+9],21,-343485551),c=c+g>>>0,l=l+b>>>0,f=f+w>>>0,d=d+x>>>0}return t.endian([c,l,f,d])};a._ff=function(e,t,r,n,i,o,a){var s=e+(t&r|~t&n)+(i>>>0)+a;return(s<<o|s>>>32-o)+t},a._gg=function(e,t,r,n,i,o,a){var s=e+(t&n|r&~n)+(i>>>0)+a;return(s<<o|s>>>32-o)+t},a._hh=function(e,t,r,n,i,o,a){var s=e+(t^r^n)+(i>>>0)+a;return(s<<o|s>>>32-o)+t},a._ii=function(e,t,r,n,i,o,a){var s=e+(r^(t|~n))+(i>>>0)+a;return(s<<o|s>>>32-o)+t},a._blocksize=16,a._digestsize=16,e.exports=function(e,r){if(void 0===e||null===e)throw new Error("Illegal argument "+e);var n=t.wordsToBytes(a(e,r));return r&&r.asBytes?n:r&&r.asString?o.bytesToString(n):t.bytesToHex(n)}}()},function(e,t){var r={utf8:{stringToBytes:function(e){return r.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(r.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],r=0;r<e.length;r++)t.push(255&e.charCodeAt(r));return t},bytesToString:function(e){for(var t=[],r=0;r<e.length;r++)t.push(String.fromCharCode(e[r]));return t.join("")}}};e.exports=r},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function i(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var o=!1,a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"isSyncing",value:function(){var e=i(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o);case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"startSync",value:function(){var e=i(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=!0,e.abrupt("return",this.isSyncing());case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"stopSync",value:function(){var e=i(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=!1,e.abrupt("return",this.isSyncing());case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();t.default=a},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==("undefined"==typeof window?"undefined":a(window))&&(r=window)}e.exports=r},function(e,t,r){var n,i;void 0===(i="function"==typeof(n=function(){return function(){function e(e){if(this.app="loki",void 0!==e&&(this.app=e),this.catalog=null,!this.checkAvailability())throw new Error("indexedDB does not seem to be supported for your environment")}function t(e){this.db=null,this.initializeLokiCatalog(e)}return e.prototype.checkAvailability=function(){return!("undefined"==typeof indexedDB||!indexedDB)},e.prototype.loadDatabase=function(e,r){var n=this.app,i=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKey(n,e,function(e){if("function"==typeof r){if(0===e.id)return void r(null);r(e.val)}else console.log(e.val)}):this.catalog=new t(function(t){i.catalog=t,i.loadDatabase(e,r)})},e.prototype.loadKey=e.prototype.loadDatabase,e.prototype.saveDatabase=function(e,r,n){var i=this.app,o=this;function a(e){e&&!0===e.success?n(null):n(new Error("Error saving database"))}null!==this.catalog&&null!==this.catalog.db?this.catalog.setAppKey(i,e,r,a):this.catalog=new t(function(t){o.catalog=t,t.setAppKey(i,e,r,a)})},e.prototype.saveKey=e.prototype.saveDatabase,e.prototype.deleteDatabase=function(e,r){var n=this.app,i=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKey(n,e,function(e){var t=e.id;0!==t?i.catalog.deleteAppKey(t,r):"function"==typeof r&&r({success:!0})}):this.catalog=new t(function(t){i.catalog=t,i.deleteDatabase(e,r)})},e.prototype.deleteKey=e.prototype.deleteDatabase,e.prototype.deleteDatabasePartitions=function(e){var t=this;this.getDatabaseList(function(r){r.forEach(function(r){r.startsWith(e)&&t.deleteDatabase(r)})})},e.prototype.getDatabaseList=function(e){var r=this.app,n=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKeys(r,function(t){for(var r=[],n=0;n<t.length;n++)r.push(t[n].key);"function"==typeof e?e(r):r.forEach(function(e){console.log(e)})}):this.catalog=new t(function(t){n.catalog=t,n.getDatabaseList(e)})},e.prototype.getKeyList=e.prototype.getDatabaseList,e.prototype.getCatalogSummary=function(e){this.app;var r=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAllKeys(function(t){for(var r,n,i,o,a,s=[],u=0;u<t.length;u++)i=(r=t[u]).app||"",o=r.key||"",a=r.val||"",n=2*i.length+2*o.length+a.length+1,s.push({app:r.app,key:r.key,size:n});"function"==typeof e?e(s):s.forEach(function(e){console.log(e)})}):this.catalog=new t(function(t){r.catalog=t,r.getCatalogSummary(e)})},t.prototype.initializeLokiCatalog=function(e){var t=indexedDB.open("LokiCatalog",1),r=this;t.onupgradeneeded=function(e){var t=e.target.result;if(t.objectStoreNames.contains("LokiAKV")&&t.deleteObjectStore("LokiAKV"),!t.objectStoreNames.contains("LokiAKV")){var r=t.createObjectStore("LokiAKV",{keyPath:"id",autoIncrement:!0});r.createIndex("app","app",{unique:!1}),r.createIndex("key","key",{unique:!1}),r.createIndex("appkey","appkey",{unique:!0})}},t.onsuccess=function(t){r.db=t.target.result,"function"==typeof e&&e(r)},t.onerror=function(e){throw e}},t.prototype.getAppKey=function(e,t,r){var n=e+","+t,i=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").index("appkey").get(n);i.onsuccess=function(e){return function(t){var r=t.target.result;null!==r&&void 0!==r||(r={id:0,success:!1}),"function"==typeof e?e(r):console.log(r)}}(r),i.onerror=function(e){return function(t){if("function"!=typeof e)throw t;e({id:0,success:!1})}}(r)},t.prototype.getAppKeyById=function(e,t,r){this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").get(e).onsuccess=function(e,t){return function(r){"function"==typeof t?t(r.target.result,e):console.log(r.target.result)}}(r,t)},t.prototype.setAppKey=function(e,t,r,n){var i=this.db.transaction(["LokiAKV"],"readwrite").objectStore("LokiAKV"),o=i.index("appkey"),a=e+","+t,s=o.get(a);s.onsuccess=function(o){var a=o.target.result;null===a||void 0===a?a={app:e,key:t,appkey:e+","+t,val:r}:a.val=r;var u=i.put(a);u.onerror=function(e){return function(t){"function"==typeof e?e({success:!1}):(console.error("LokiCatalog.setAppKey (set) onerror"),console.error(s.error))}}(n),u.onsuccess=function(e){return function(t){"function"==typeof e&&e({success:!0})}}(n)},s.onerror=function(e){return function(t){"function"==typeof e?e({success:!1}):(console.error("LokiCatalog.setAppKey (get) onerror"),console.error(s.error))}}(n)},t.prototype.deleteAppKey=function(e,t){var r=this.db.transaction(["LokiAKV"],"readwrite").objectStore("LokiAKV").delete(e);r.onsuccess=function(e){return function(t){"function"==typeof e&&e({success:!0})}}(t),r.onerror=function(e){return function(t){"function"==typeof e?e({success:!1}):(console.error("LokiCatalog.deleteAppKey raised onerror"),console.error(r.error))}}(t)},t.prototype.getAppKeys=function(e,t){var r=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").index("app"),n=IDBKeyRange.only(e),i=r.openCursor(n);i.onsuccess=function(e,t){return function(r){var n=r.target.result;if(n){var i=n.value;e.push(i),n.continue()}else"function"==typeof t?t(e):console.log(e)}}([],t),i.onerror=function(e){return function(t){"function"==typeof e?e(null):(console.error("LokiCatalog.getAppKeys raised onerror"),console.error(t))}}(t)},t.prototype.getAllKeys=function(e){var t=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").openCursor();t.onsuccess=function(e,t){return function(r){var n=r.target.result;if(n){var i=n.value;e.push(i),n.continue()}else"function"==typeof t?t(e):console.log(e)}}([],e),t.onerror=function(e){return function(t){"function"==typeof e&&e(null)}}(e)},e}()})?n.apply(t,[]):n)||(e.exports=i)},function(e,t,r){var n=r(37),i=r(38);e.exports=function(e,t,r){var o=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||n)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var s=0;s<16;++s)t[o+s]=a[s];return t||i(a)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Utilities=t.Sync=t.Hash=t.Role=t.OfflinePlugin=t.User=t.Import=t.Translation=t.Configuration=t.ParallelSurvey=t.Submission=t.Pages=t.Form=t.Auth=t.Connection=t.FAST=t.Event=t.Moment=void 0;var n=x(r(24)),i=x(r(14)),o=x(r(5)),a=x(r(9)),s=x(r(41)),u=x(r(4)),c=x(r(11)),l=x(r(8)),f=x(r(42)),d=x(r(2)),h=x(r(10)),p=x(r(43)),v=x(r(12)),m=x(r(44)),y=x(r(15)),g=x(r(46)),b=x(r(16)),w=x(r(0));function x(e){return e&&e.__esModule?e:{default:e}}t.Moment=s.default,t.Event=a.default,t.FAST=n.default,t.Connection=o.default,t.Auth=i.default,t.Form=u.default,t.Pages=c.default,t.Submission=l.default,t.ParallelSurvey=f.default,t.Configuration=d.default,t.Translation=h.default,t.Import=p.default,t.User=v.default,t.OfflinePlugin=m.default,t.Role=y.default,t.Hash=g.default,t.Sync=b.default,t.Utilities=w.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(2)),i=d(r(4)),o=d(r(10)),a=d(r(11)),s=(d(r(27)),d(r(15))),u=r(1),c=d(r(32)),l=d(r(39)),f=d(r(40));function d(e){return e&&e.__esModule?e:{default:e}}function h(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var p=function(){var e=function(){var e=h(regeneratorRuntime.mark(function e(t){var r,d,h=t.appConf,p=t.forceOnline;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p){e.next=3;break}return e.next=3,u.Fluent.config({REMOTE_CONNECTORS:[{default:!0,name:"formio",baseUrl:h.fluentFormioBaseUrl,connector:l.default},{name:"formioConfig",baseUrl:h.appConfigUrl,connector:l.default}],LOCAL_CONNECTORS:[{name:"loki",connector:c.default,default:!0}],MERGE_CONNECTORS:[{default:!0,name:"formioLoki",connector:f.default}]});case 3:return e.next=5,n.default.set({appConf:h,forceOnline:p});case 5:return r=e.sent,e.next=8,s.default.set({appConf:h,forceOnline:p});case 8:return e.next=10,a.default.set({appConf:h,forceOnline:p});case 10:return e.next=12,i.default.set({appConf:h,forceOnline:p});case 12:return e.next=14,o.default.set({appConf:h,forceOnline:p});case 14:return d=e.sent,e.abrupt("return",{config:r,translations:d,defaultLanguage:localStorage.getItem("defaultLenguage")||"en"});case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t=function(){var t=h(regeneratorRuntime.mark(function t(r){var n=r.appConf;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e({appConf:n,forceOnline:!0}));case 1:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}();return Object.freeze({start:e,sync:t})}();t.default=p},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=u(r(0)),a=u(r(10)),s=u(r(11));function u(e){return e&&e.__esModule?e:{default:e}}function c(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,null,[{key:"get",value:function(){var e=c(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.handle(t,r));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"handle",value:function(){var e=c(regeneratorRuntime.mark(function e(t,r){var n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchAllLabels(t,r);case 2:return n=e.sent,e.next=5,a.default.local().first();case 5:return i=e.sent.data,Object.keys(i).forEach(function(e){var t=i[e];Object.keys(t).forEach(function(r){n[r]&&t[r]&&""!==t[r]&&(n[r].translations[e]=t[r])})}),e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"fetchAllLabels",value:function(){var e=c(regeneratorRuntime.mark(function e(t,r){var n,i,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={},t=t.map(function(e){return e.data}),i=this.getFormLabels(t),e.next=5,this.getAppLabels(r);case 5:return o=e.sent,n=this.mergeLabels(i,o),e.t0=this,e.next=10,s.default.local().first();case 10:return e.t1=e.sent,e.next=13,e.t0.getPagesLabels.call(e.t0,e.t1);case 13:return a=e.sent,n=this.mergeLabels(n,a),e.abrupt("return",n);case 16:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"createOrAdd",value:function(e){var t=e.labels,r=e.label,i=n({},t);return i[r.text]?r.location&&Array.isArray(r.location)?r.location.forEach(function(e){i[r.text].location.push({text:r.text,template:r.template,type:e.type,picture:e.picture})}):i[r.text].location.push(r):r.location&&Array.isArray(r.location)?(i[r.text]={location:[],template:r.template,translations:{}},r.location.forEach(function(e){i[r.text].location.push({text:r.text,template:r.template,type:e.type,picture:e.picture})})):i[r.text]={location:[r],translations:{}},i}},{key:"mergeLabels",value:function(e,t){var r=this,i=n({},e);return Object.keys(t).forEach(function(e){i=r.createOrAdd({labels:i,label:n({},t[e],{text:e})})}),i}},{key:"getFormLabels",value:function(e){var t=this,r={},n=["suffix","prefix","addAnother","removeRow","saveRow","legend","title","label","placeholder","tooltip"];return e.forEach(function(e){r=t.createOrAdd({labels:r,label:{text:e.title,type:"formTitle",component:e.path,form:e.path,picture:null}}),o.default.eachComponent(e.components,function(i){n.forEach(function(n){i[n]&&""!==i[n]&&(r=t.createOrAdd({labels:r,label:{text:i[n],type:n,component:i.key,form:e.path,picture:null}}))}),i.values&&i.values.forEach(function(n){n.label&&""!==n.label&&(r=t.createOrAdd({labels:r,label:{text:n.label,type:"value",component:i.key,form:e.path,picture:null}}))}),"htmlelement"===i.type&&""!==i.content&&(r=t.createOrAdd({labels:r,label:{text:i.content,type:"htmlElement",component:i.key,form:e.path,picture:null}})),"select"===i.type&&i.data&&i.data.values&&i.data.values.forEach(function(n){n.label&&""!==n.label&&(r=t.createOrAdd({labels:r,label:{text:n.label,type:"selectValue",component:i.key,form:e.path,picture:null}}))}),i.type&&"survey"===i.type&&i.questions&&(i.questions.forEach(function(n){r=t.createOrAdd({labels:r,label:{text:n.label,type:"surveyLabel",component:i.key,form:e.path,picture:null}})}),i.values.forEach(function(n){r=t.createOrAdd({labels:r,label:{text:n.label,type:"surveyValues",component:i.key,form:e.path,picture:null}})}))},!0)}),r}},{key:"getAppLabels",value:function(){var e=c(regeneratorRuntime.mark(function e(t){var r,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={},t.forEach(function(e){r=n.createOrAdd({labels:r,label:e})}),e.abrupt("return",r);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPagesLabels",value:function(){var e=c(regeneratorRuntime.mark(function e(t){var r,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={},t.pages.forEach(function(e){e.title&&""!==e.title&&(r=n.createOrAdd({labels:r,label:{text:e.title,type:"pageTitle",picture:null,page:e}})),e.cards.forEach(function(t){t.title&&""!==t.title&&(r=n.createOrAdd({labels:r,label:{text:t.title,type:"pageCardTitle",picture:null,card:t,page:e}})),t.subtitle&&""!==t.subtitle&&n.createOrAdd({labels:r,label:{text:t.subtitle,type:"pageCardSubtitle",picture:null,card:t,page:e}}),t.actions.forEach(function(i){i.text&&""!==i.text&&(r=n.createOrAdd({labels:r,label:{text:i.text,type:"pageActionButtonText",picture:null,card:t,page:e}}))})})}),e.abrupt("return",r);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();t.default=l},function(e){e.exports=[{code:"ab",direction:"ltr",label:"Abkhazian"},{code:"aa",direction:"ltr",label:"Afar"},{code:"af",direction:"ltr",label:"Afrikaans"},{code:"ak",direction:"ltr",label:"Akan"},{code:"sq",direction:"ltr",label:"Albanian"},{code:"am",direction:"ltr",label:"Amharic"},{code:"ar",direction:"rtl",label:"Arabic"},{code:"an",direction:"ltr",label:"Aragonese"},{code:"hy",direction:"ltr",label:"Armenian"},{code:"as",direction:"ltr",label:"Assamese"},{code:"av",direction:"ltr",label:"Avaric"},{code:"ae",direction:"ltr",label:"Avestan"},{code:"ay",direction:"ltr",label:"Aymara"},{code:"az",direction:"ltr",label:"Azerbaijani"},{code:"bm",direction:"ltr",label:"Bambara"},{code:"ba",direction:"ltr",label:"Bashkir"},{code:"eu",direction:"ltr",label:"Basque"},{code:"be",direction:"ltr",label:"Belarusian"},{code:"bn",direction:"ltr",label:"Bengali"},{code:"bh",direction:"ltr",label:"Bihari languages"},{code:"bi",direction:"ltr",label:"Bislama"},{code:"bs",direction:"ltr",label:"Bosnian"},{code:"br",direction:"ltr",label:"Breton"},{code:"bg",direction:"ltr",label:"Bulgarian"},{code:"my",direction:"ltr",label:"Burmese"},{code:"ca",direction:"ltr",label:"Catalan, Valencian"},{code:"km",direction:"ltr",label:"Central Khmer"},{code:"ch",direction:"ltr",label:"Chamorro"},{code:"ce",direction:"ltr",label:"Chechen"},{code:"ny",direction:"ltr",label:"Chichewa"},{code:"zh",direction:"ltr",label:"Chinese"},{code:"cu",direction:"ltr",label:"Church Slavonic, Old Bulgarian, Old Church Slavonic"},{code:"cv",direction:"ltr",label:"Chuvash"},{code:"kw",direction:"ltr",label:"Cornish"},{code:"co",direction:"ltr",label:"Corsican"},{code:"cr",direction:"ltr",label:"Cree"},{code:"hr",direction:"ltr",label:"Croatian"},{code:"cs",direction:"ltr",label:"Czech"},{code:"da",direction:"ltr",label:"Danish"},{code:"dv",direction:"ltr",label:"Divehi, Dhivehi, Maldivian"},{code:"nl",direction:"ltr",label:"Dutch, Flemish"},{code:"dz",direction:"ltr",label:"Dzongkha"},{code:"en",direction:"ltr",label:"English"},{code:"eo",direction:"ltr",label:"Esperanto"},{code:"et",direction:"ltr",label:"Estonian"},{code:"ee",direction:"ltr",label:"Ewe"},{code:"fo",direction:"ltr",label:"Faroese"},{code:"fj",direction:"ltr",label:"Fijian"},{code:"fi",direction:"ltr",label:"Finnish"},{code:"fr",direction:"ltr",label:"French"},{code:"ff",direction:"ltr",label:"Fulah"},{code:"gd",direction:"ltr",label:"Gaelic, Scottish Gaelic"},{code:"gl",direction:"ltr",label:"Galician"},{code:"lg",direction:"ltr",label:"Ganda"},{code:"ka",direction:"ltr",label:"Georgian"},{code:"de",direction:"ltr",label:"German"},{code:"ki",direction:"ltr",label:"Gikuyu, Kikuyu"},{code:"el",direction:"ltr",label:"Greek (Modern)"},{code:"kl",direction:"ltr",label:"Greenlandic, Kalaallisut"},{code:"gn",direction:"ltr",label:"Guarani"},{code:"gu",direction:"ltr",label:"Gujarati"},{code:"ht",direction:"ltr",label:"Haitian, Haitian Creole"},{code:"ha",direction:"ltr",label:"Hausa"},{code:"he",direction:"ltr",label:"Hebrew"},{code:"hz",direction:"ltr",label:"Herero"},{code:"hi",direction:"ltr",label:"Hindi"},{code:"ho",direction:"ltr",label:"Hiri Motu"},{code:"hu",direction:"ltr",label:"Hungarian"},{code:"is",direction:"ltr",label:"Icelandic"},{code:"io",direction:"ltr",label:"Ido"},{code:"ig",direction:"ltr",label:"Igbo"},{code:"id",direction:"ltr",label:"Indonesian"},{code:"ia",direction:"ltr",label:"Interlingua (International Auxiliary Language Association)"},{code:"ie",direction:"ltr",label:"Interlingue"},{code:"iu",direction:"ltr",label:"Inuktitut"},{code:"ik",direction:"ltr",label:"Inupiaq"},{code:"ga",direction:"ltr",label:"Irish"},{code:"it",direction:"ltr",label:"Italian"},{code:"ja",direction:"ltr",label:"Japanese"},{code:"jv",direction:"ltr",label:"Javanese"},{code:"kn",direction:"ltr",label:"Kannada"},{code:"kr",direction:"ltr",label:"Kanuri"},{code:"ks",direction:"ltr",label:"Kashmiri"},{code:"kk",direction:"ltr",label:"Kazakh"},{code:"rw",direction:"ltr",label:"Kinyarwanda"},{code:"kv",direction:"ltr",label:"Komi"},{code:"kg",direction:"ltr",label:"Kongo"},{code:"ko",direction:"ltr",label:"Korean"},{code:"kj",direction:"ltr",label:"Kwanyama, Kuanyama"},{code:"ku",direction:"ltr",label:"Kurdish"},{code:"ky",direction:"ltr",label:"Kyrgyz"},{code:"lo",direction:"ltr",label:"Lao"},{code:"la",direction:"ltr",label:"Latin"},{code:"lv",direction:"ltr",label:"Latvian"},{code:"lb",direction:"ltr",label:"Letzeburgesch, Luxembourgish"},{code:"li",direction:"ltr",label:"Limburgish, Limburgan, Limburger"},{code:"ln",direction:"ltr",label:"Lingala"},{code:"lt",direction:"ltr",label:"Lithuanian"},{code:"lu",direction:"ltr",label:"Luba-Katanga"},{code:"mk",direction:"ltr",label:"Macedonian"},{code:"mg",direction:"ltr",label:"Malagasy"},{code:"ms",direction:"ltr",label:"Malay"},{code:"ml",direction:"ltr",label:"Malayalam"},{code:"mt",direction:"ltr",label:"Maltese"},{code:"gv",direction:"ltr",label:"Manx"},{code:"mi",direction:"ltr",label:"Maori"},{code:"mr",direction:"ltr",label:"Marathi"},{code:"mh",direction:"ltr",label:"Marshallese"},{code:"ro",direction:"ltr",label:"Moldovan, Moldavian, Romanian"},{code:"mn",direction:"ltr",label:"Mongolian"},{code:"na",direction:"ltr",label:"Nauru"},{code:"nv",direction:"ltr",label:"Navajo, Navaho"},{code:"nd",direction:"ltr",label:"Northern Ndebele"},{code:"ng",direction:"ltr",label:"Ndonga"},{code:"ne",direction:"ltr",label:"Nepali"},{code:"se",direction:"ltr",label:"Northern Sami"},{code:"no",direction:"ltr",label:"Norwegian"},{code:"nb",direction:"ltr",label:"Norwegian Bokmål"},{code:"nn",direction:"ltr",label:"Norwegian Nynorsk"},{code:"ii",direction:"ltr",label:"Nuosu, Sichuan Yi"},{code:"oc",direction:"ltr",label:"Occitan (post 1500)"},{code:"oj",direction:"ltr",label:"Ojibwa"},{code:"or",direction:"ltr",label:"Oriya"},{code:"om",direction:"ltr",label:"Oromo"},{code:"os",direction:"ltr",label:"Ossetian, Ossetic"},{code:"pi",direction:"ltr",label:"Pali"},{code:"pa",direction:"ltr",label:"Panjabi, Punjabi"},{code:"ps",direction:"ltr",label:"Pashto, Pushto"},{code:"fa",direction:"ltr",label:"Persian"},{code:"pl",direction:"ltr",label:"Polish"},{code:"pt",direction:"ltr",label:"Portuguese"},{code:"qu",direction:"ltr",label:"Quechua"},{code:"rm",direction:"ltr",label:"Romansh"},{code:"rn",direction:"ltr",label:"Rundi"},{code:"ru",direction:"ltr",label:"Russian"},{code:"sm",direction:"ltr",label:"Samoan"},{code:"sg",direction:"ltr",label:"Sango"},{code:"sa",direction:"ltr",label:"Sanskrit"},{code:"sc",direction:"ltr",label:"Sardinian"},{code:"sr",direction:"ltr",label:"Serbian"},{code:"sn",direction:"ltr",label:"Shona"},{code:"sd",direction:"ltr",label:"Sindhi"},{code:"si",direction:"ltr",label:"Sinhala, Sinhalese"},{code:"sk",direction:"ltr",label:"Slovak"},{code:"sl",direction:"ltr",label:"Slovenian"},{code:"so",direction:"ltr",label:"Somali"},{code:"st",direction:"ltr",label:"Sotho, Southern"},{code:"nr",direction:"ltr",label:"South Ndebele"},{code:"es",direction:"ltr",label:"Spanish"},{code:"su",direction:"ltr",label:"Sundanese"},{code:"sw",direction:"ltr",label:"Swahili"},{code:"ss",direction:"ltr",label:"Swati"},{code:"sv",direction:"ltr",label:"Swedish"},{code:"tl",direction:"ltr",label:"Tagalog"},{code:"ty",direction:"ltr",label:"Tahitian"},{code:"tg",direction:"ltr",label:"Tajik"},{code:"ta",direction:"ltr",label:"Tamil"},{code:"tt",direction:"ltr",label:"Tatar"},{code:"te",direction:"ltr",label:"Telugu"},{code:"th",direction:"ltr",label:"Thai"},{code:"bo",direction:"ltr",label:"Tibetan"},{code:"ti",direction:"ltr",label:"Tigrinya"},{code:"to",direction:"ltr",label:"Tonga (Tonga Islands)"},{code:"ts",direction:"ltr",label:"Tsonga"},{code:"tn",direction:"ltr",label:"Tswana"},{code:"tr",direction:"ltr",label:"Turkish"},{code:"tk",direction:"ltr",label:"Turkmen"},{code:"tw",direction:"ltr",label:"Twi"},{code:"ug",direction:"ltr",label:"Uighur, Uyghur"},{code:"uk",direction:"ltr",label:"Ukrainian"},{code:"umb",direction:"ltr",label:"Umbundu"},{code:"ur",direction:"ltr",label:"Urdu"},{code:"uz",direction:"ltr",label:"Uzbek"},{code:"ve",direction:"ltr",label:"Venda"},{code:"vi",direction:"ltr",label:"Vietnamese"},{code:"vo",direction:"ltr",label:"Volap_k"},{code:"wa",direction:"ltr",label:"Walloon"},{code:"cy",direction:"ltr",label:"Welsh"},{code:"fy",direction:"ltr",label:"Western Frisian"},{code:"wo",direction:"ltr",label:"Wolof"},{code:"xh",direction:"ltr",label:"Xhosa"},{code:"yi",direction:"ltr",label:"Yiddish"},{code:"yo",direction:"ltr",label:"Yoruba"},{code:"za",direction:"ltr",label:"Zhuang, Chuang"},{code:"zu",direction:"ltr",label:"Zulu"}]},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=o(r(16)),i=o(r(0));function o(e){return e&&e.__esModule?e:{default:e}}var a=function(){var e=function(){var e=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}(regeneratorRuntime.mark(function e(t){var r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=function(e,t){var r=Date.now,n="undefined"!=typeof window&&window.requestAnimationFrame,i=r(),o=void 0;return n(function a(){r()-i<t||(i+=t,e()),o||n(a)}),{clear:function(){o=1}}},o=i.default.debounce(n.default.now,2e3),r(o,t);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}();return Object.freeze({set:e})}();t.default=a},function(e,t){!function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&r.rotl(e,8)|4278255360&r.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=r.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],r=0,n=0;r<e.length;r++,n+=8)t[n>>>5]|=e[r]<<24-n%32;return t},wordsToBytes:function(e){for(var t=[],r=0;r<32*e.length;r+=8)t.push(e[r>>>5]>>>24-r%32&255);return t},bytesToHex:function(e){for(var t=[],r=0;r<e.length;r++)t.push((e[r]>>>4).toString(16)),t.push((15&e[r]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(parseInt(e.substr(r,2),16));return t},bytesToBase64:function(e){for(var r=[],n=0;n<e.length;n+=3)for(var i=e[n]<<16|e[n+1]<<8|e[n+2],o=0;o<4;o++)8*n+6*o<=8*e.length?r.push(t.charAt(i>>>6*(3-o)&63)):r.push("=");return r.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var r=[],n=0,i=0;n<e.length;i=++n%4)0!=i&&r.push((t.indexOf(e.charAt(n-1))&Math.pow(2,-2*i+8)-1)<<2*i|t.indexOf(e.charAt(n))>>>6-2*i);return r}};e.exports=r}()},function(e,t){function r(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}
/*!
     * Determine if an object is a Buffer
     *
     * @author   Feross Aboukhadijeh <https://feross.org>
     * @license  MIT
     */e.exports=function(e){return null!=e&&(r(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&r(e.slice(0,0))}(e)||!!e._isBuffer)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=a(r(0)),o=a(r(4));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"getTableView",value:function(){var e=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.default.find({path:t});case 2:return r=e.sent.data,e.abrupt("return",i.default.findComponents(r.components,{input:!0,tableView:!0}).slice(0,7).filter(function(e){return!(""===e.label)}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();t.default=s},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=l(r(5)),o=l(r(8)),a=l(r(9)),s=l(r(19)),u=l(r(4)),c=l(r(6));function l(e){return e&&e.__esModule?e:{default:e}}function f(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var d=function(){var e=function(){var e=f(regeneratorRuntime.mark(function e(r){var o,u,l,d,h,p,v=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=r,e.next=3,i.default.isOnline();case 3:if(u=e.sent,l=function(){var e=f(regeneratorRuntime.mark(function e(t,r){var n,i,o,a,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=!0,i=!1,o=void 0,e.prev=3,a=t[Symbol.iterator]();case 5:if(n=(s=a.next()).done){e.next=12;break}return u=s.value,e.next=9,r(u);case 9:n=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),i=!0,o=e.t0;case 18:e.prev=18,e.prev=19,!n&&a.return&&a.return();case 21:if(e.prev=21,!i){e.next=24;break}throw o;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}},e,this,[[3,14,18,26],[19,,21,25]])}));return function(t,r){return e.apply(this,arguments)}}(),!u){e.next=17;break}return e.next=8,s.default.startSync();case 8:return e.next=10,(0,c.default)(l(o,function(){var e=f(regeneratorRuntime.mark(function e(r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t(r);case 2:case"end":return e.stop()}},e,v)}));return function(t){return e.apply(this,arguments)}}()));case 10:d=e.sent,h=n(d,1),p=h[0],s.default.stopSync(),p&&console.log(p),console.log("Submissions Synced"),a.default.emit({name:"FAST:SUBMISSION:SYNCED",data:{},text:"The submissions have been synced"});case 17:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t=function(){var e=f(regeneratorRuntime.mark(function e(t){var r,i,a,s,l,f,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.default.getModel({path:t.path}).remote(),t.queuedForSync=!0,i=(0,o.default)(t.path),e.next=5,i.local().update(t);case 5:return e.next=7,(0,c.default)(r.insert(t));case 7:if(a=e.sent,s=n(a,2),l=s[0],f=s[1],!l){e.next=17;break}throw console.log(l),t.queuedForSync=!1,t.syncError=l,i.local().update(t),new Error("Error while Syncing data");case 17:if(f._id){e.next=19;break}throw Error("The remote endpoint did not save the submission properly (no _id back)");case 19:return e.next=21,(0,c.default)(i.local().remove(t._id));case 21:if(d=e.sent,!n(d,1)[0]){e.next=26;break}throw new Error("Sync error:Could not remove local submission after sync");case 26:return e.abrupt("return",!0);case 27:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}();return Object.freeze({send:e})}();t.default=d},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=u(r(33)),o=u(r(0)),a=u(r(22)),s=r(1);function u(e){return e&&e.__esModule?e:{default:e}}function c(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}t.default=s.Interface.compose({methods:{get:function(){var e=this;return c(regeneratorRuntime.mark(function t(){var r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.ownerEmail&&e.andWhere("user_email","=",e.ownerEmail),r=e.prepareFilter(),t.next=4,e.getModel();case 4:return t.t0=r,t.t1=e.offsetNumber,t.t2=e.limitNumber,t.next=9,t.sent.chain().find(t.t0).offset(t.t1).limit(t.t2).data();case 9:return n=t.sent,n=e.jsApplySelect(n),n=e.jsApplyOrderBy(n),t.abrupt("return",n);case 13:case"end":return t.stop()}},t,e)}))()},prepareFilter:function(){var e=this,t={$and:[]},r={$or:[]},n={};return this.whereArray.length>0&&(this.whereArray.forEach(function(r){var n={};if(r[0].includes("["))throw new Error('Error in: "'+r[0]+'" "Where" close does not work with Array elements');n[r[0]]={};var i=e.getLokiOperator(r[1]);n[r[0]][i]=r[2],i.includes("$regex|")&&(delete n[r[0]][i],n[r[0]].$regex=i.replace("$regex|","").replace("{{$var}}",r[2])),t.$and.push(n)}),n=t),this.orWhereArray.length>0&&(this.orWhereArray.forEach(function(t){var n={};n[t[0]]={};var i=e.getLokiOperator(t[1]);n[t[0]][i]=t[2],i.includes("$regex|")&&(delete n[t[0]][i],n[t[0]].$regex=i.replace("$regex|","").replace("{{$var}}",t[2])),r.$or.push(n)}),n={$or:[t,r]}),n},getLokiOperator:function(e){if(!this.operators.includes(e))throw new Error('The "'+e+'" operator is not supported');var t={"=":"$eq","<":"$lt",">":"$gt","<=":"$lte",">=":"$gte","<>":"$ne","!=":"$ne",in:"$in",nin:"$nin",like:"$aeq",regexp:"$regex",startsWith:"$regex|^{{$var}}",endsWith:"$regex|{{$var}}$",contains:"$regex|{{$var}}"},r=o.default.get(function(){return t[e]},void 0);if(!r)throw new Error('The operator "'+e+'" is not supported in Loki ');return r},getModel:function(){var e=this;return c(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.default.get();case 2:return r=t.sent,t.abrupt("return",r.getCollection(e.name));case 4:case"end":return t.stop()}},t,e)}))()},all:function(){var e=this;return c(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getModel();case 2:return r=t.sent,t.abrupt("return",r.find());case 4:case"end":return t.stop()}},t,e)}))()},remove:function(e){var t=this;return c(regeneratorRuntime.mark(function r(){var n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(e){r.next=2;break}throw new Error("No id assign to remove().You must give and _id to delete");case 2:if(e.includes("_local")){r.next=4;break}throw new Error("You can`t delete non local submissions");case 4:return r.next=6,t.getModel();case 6:return n=r.sent,r.abrupt("return",n.findAndRemove({_id:e}));case 8:case"end":return r.stop()}},r,t)}))()},insert:function(e,t){var r=this;return c(regeneratorRuntime.mark(function n(){var i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!Array.isArray(e)){n.next=2;break}return n.abrupt("return",r.ArrayInsert(e,t));case 2:return e=o.default.cloneDeep(e),n.next=5,r.getModel();case 5:return i=n.sent,e._id=(0,a.default)()+"_local",n.abrupt("return",i.insert(e));case 8:case"end":return n.stop()}},n,r)}))()},update:function(e){var t=this;return c(regeneratorRuntime.mark(function r(){var i,o,a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(e._id){r.next=2;break}throw new Error("Loki connector error. Cannot update a Model without _id key");case 2:return r.next=4,t.getModel();case 4:return i=r.sent,e.modified=Math.round(+new Date/1e3),r.next=8,i.findOne({_id:e._id});case 8:return o=r.sent,a=n({},o,e),r.abrupt("return",i.update(a));case 11:case"end":return r.stop()}},r,t)}))()},updateOrCreate:function(e){var t=this;return c(regeneratorRuntime.mark(function r(){var n,i=e.document;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getModel();case 2:return n=e.sent,e.next=5,n.findOne(i);case 5:e.sent||n.insert(i);case 7:case"end":return e.stop()}},r,t)}))()},findAndRemove:function(e){var t=this;return c(regeneratorRuntime.mark(function r(){var n,i=e.filter;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getModel();case 2:return n=e.sent,e.abrupt("return",n.findAndRemove(i));case 4:case"end":return e.stop()}},r,t)}))()},clear:function(){var e=this;return c(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getModel();case 2:return r=t.sent,t.abrupt("return",r.clear({removeIndices:!0}));case 4:case"end":return t.stop()}},t,e)}))()}}})},function(e,t,r){(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=s(r(7)),o=s(r(34)),a=s(r(21));function s(e){return e&&e.__esModule?e:{default:e}}var u=null,c=function(){var t=function(){return"undefined"!=typeof window&&window&&window._FLUENT_&&window._FLUENT_.models?window._FLUENT_.models:e&&e._FLUENT_&&e._FLUENT_.models?e._FLUENT_.models:void 0},r=function(){var e=t(),r=u.collections.reduce(function(e,t){return e.push(t.name),e},[]),n=[];return Object.keys(e).forEach(function(e){r.includes(e)||n.push(e)}),n},s=function(){var e=function(e){return function(){var t=e.apply(this,arguments);return new i.default(function(e,r){return function n(o,a){try{var s=t[o](a),u=s.value}catch(e){return void r(e)}if(!s.done)return i.default.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});e(u)}("next")})}}(regeneratorRuntime.mark(function e(){var s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(u){e.next=4;break}return e.next=3,new i.default(function(e){var r=void 0,i=void 0,s=void 0,u={autosave:!0,autosaveInterval:1e3,autoload:!0,autoloadCallback:function(){var r=t();if(!r)throw new Error('Cannot Start FLUENT, no models registered or you dont have access to the "window" or "global" variable');Object.keys(r).forEach(function(e){s.getCollection(e)||s.addCollection(e)}),e(s)},throttledSaves:!1};try{r=new a.default("FAST"),i=new o.default.LokiPartitioningAdapter(r,{paging:!0}),s=new o.default("FAST",n({},u,{adapter:i}))}catch(e){s=new o.default("FAST",u)}});case 3:u=e.sent;case 4:return(s=r()).length>0&&s.forEach(function(e){u.addCollection(e)}),e.abrupt("return",u);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}();return Object.freeze({get:s})}();t.default=c}).call(this,r(20))},function(e,t,r){(function(n,i){var o,s;void 0===(s="function"==typeof(o=function(){return function(){var e=Object.prototype.hasOwnProperty,t={copyProperties:function(e,t){var r;for(r in e)t[r]=e[r]},resolveTransformObject:function(e,r,n){var i,o;if("number"!=typeof n&&(n=0),++n>=10)return e;for(i in e)"string"==typeof e[i]&&0===e[i].indexOf("[%lktxp]")?(o=e[i].substring(8),r.hasOwnProperty(o)&&(e[i]=r[o])):"object"==a(e[i])&&(e[i]=t.resolveTransformObject(e[i],r,n));return e},resolveTransformParams:function(e,r){var n,i,o=[];if(void 0===r)return e;for(n=0;n<e.length;n++)i=m(e[n],"shallow-recurse-objects"),o.push(t.resolveTransformObject(i,r));return o}},o={aeq:s,lt:u,gt:c};function s(e,t){var r,n,i,o;if(e===t)return!0;if(!e||!t||!0===e||!0===t||e!=e||t!=t){switch(e){case void 0:case null:i=1;break;case!1:i=3;break;case!0:i=4;break;case"":i=5;break;default:i=e==e?9:0}switch(t){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=t==t?9:0}if(9!==i||9!==o)return i===o}return r=Number(e),n=Number(t),r==r||n==n?r===n:(r=e.toString())==(n=t.toString())}function u(e,t,r){var n,i,o,a;if(!e||!t||!0===e||!0===t||e!=e||t!=t){switch(e){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=e==e?9:0}switch(t){case void 0:case null:a=1;break;case!1:a=3;break;case!0:a=4;break;case"":a=5;break;default:a=t==t?9:0}if(9!==o||9!==a)return o===a?r:o<a}return n=Number(e),i=Number(t),n==n&&i==i?n<i||!(n>i)&&r:n==n&&i!=i||(i!=i||n==n)&&(e<t||!(e>t)&&(e==t?r:(n=e.toString())<(i=t.toString())||n==i&&r))}function c(e,t,r){var n,i,o,a;if(!e||!t||!0===e||!0===t||e!=e||t!=t){switch(e){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=e==e?9:0}switch(t){case void 0:case null:a=1;break;case!1:a=3;break;case!0:a=4;break;case"":a=5;break;default:a=t==t?9:0}if(9!==o||9!==a)return o===a?r:o>a}return n=Number(e),i=Number(t),n==n&&i==i?n>i||!(n<i)&&r:(n!=n||i==i)&&(i==i&&n!=n||e>t||!(e<t)&&(e==t?r:(n=e.toString())>(i=t.toString())||n==i&&r))}function l(e,t,r){return o.aeq(e,t)?0:o.lt(e,t,!1)?r?1:-1:o.gt(e,t,!1)?r?-1:1:0}function f(t,r,n,i,o){var a=o||0,s=r[a];if(void 0===t||null===t||!e.call(t,s))return!1;var u=!1,c=t[s];if(a+1>=r.length)u=n(c,i);else if(Array.isArray(c))for(var l=0,d=c.length;l<d&&!0!==(u=f(c[l],r,n,i,a+1));l+=1);else u=f(c,r,n,i,a+1);return u}function d(t){return"string"==typeof t||Array.isArray(t)?function(e){return-1!==t.indexOf(e)}:"object"==(void 0===t?"undefined":a(t))&&null!==t?function(r){return e.call(t,r)}:null}function h(t,r){for(var n in r)if(e.call(r,n))return p[n](t,r[n]);return!1}var p={$eq:function(e,t){return e===t},$aeq:function(e,t){return e==t},$ne:function(e,t){return t!=t?e==e:e!==t},$dteq:function(e,t){return o.aeq(e,t)},$gt:function(e,t){return o.gt(e,t,!1)},$gte:function(e,t){return o.gt(e,t,!0)},$lt:function(e,t){return o.lt(e,t,!1)},$lte:function(e,t){return o.lt(e,t,!0)},$jgt:function(e,t){return e>t},$jgte:function(e,t){return e>=t},$jlt:function(e,t){return e<t},$jlte:function(e,t){return e<=t},$between:function(e,t){return void 0!==e&&null!==e&&o.gt(e,t[0],!0)&&o.lt(e,t[1],!0)},$jbetween:function(e,t){return void 0!==e&&null!==e&&e>=t[0]&&e<=t[1]},$in:function(e,t){return-1!==t.indexOf(e)},$nin:function(e,t){return-1===t.indexOf(e)},$keyin:function(e,t){return e in t},$nkeyin:function(e,t){return!(e in t)},$definedin:function(e,t){return void 0!==t[e]},$undefinedin:function(e,t){return void 0===t[e]},$regex:function(e,t){return t.test(e)},$containsString:function(e,t){return"string"==typeof e&&-1!==e.indexOf(t)},$containsNone:function(e,t){return!p.$containsAny(e,t)},$containsAny:function(e,t){var r=d(e);return null!==r&&(Array.isArray(t)?t.some(r):r(t))},$contains:function(e,t){var r=d(e);return null!==r&&(Array.isArray(t)?t.every(r):r(t))},$type:function(e,t){var r=void 0===e?"undefined":a(e);return"object"===r&&(Array.isArray(e)?r="array":e instanceof Date&&(r="date")),"object"!=(void 0===t?"undefined":a(t))?r===t:h(r,t)},$finite:function(e,t){return t===isFinite(e)},$size:function(e,t){return!!Array.isArray(e)&&("object"!=(void 0===t?"undefined":a(t))?e.length===t:h(e.length,t))},$len:function(e,t){return"string"==typeof e&&("object"!=(void 0===t?"undefined":a(t))?e.length===t:h(e.length,t))},$where:function(e,t){return!0===t(e)},$not:function(e,t){return!h(e,t)},$and:function(e,t){for(var r=0,n=t.length;r<n;r+=1)if(!h(e,t[r]))return!1;return!0},$or:function(e,t){for(var r=0,n=t.length;r<n;r+=1)if(h(e,t[r]))return!0;return!1}},v={$eq:p.$eq,$aeq:!0,$dteq:!0,$gt:!0,$gte:!0,$lt:!0,$lte:!0,$in:!0,$between:!0};function m(e,t){if(null===e||void 0===e)return null;var r;switch(t||"parse-stringify"){case"parse-stringify":r=JSON.parse(JSON.stringify(e));break;case"jquery-extend-deep":r=jQuery.extend(!0,{},e);break;case"shallow":r=Object.create(e.constructor.prototype),Object.keys(e).map(function(t){r[t]=e[t]});break;case"shallow-assign":r=Object.create(e.constructor.prototype),Object.assign(r,e);break;case"shallow-recurse-objects":r=m(e,"shallow"),Object.keys(e).forEach(function(t){"object"==a(e[t])&&"Object"===e[t].constructor.name&&(r[t]=m(e[t],"shallow-recurse-objects"))})}return r}function y(){try{return window&&void 0!==window.localStorage&&null!==window.localStorage}catch(e){return!1}}function g(){}function b(e,t){this.filename=e||"loki.db",this.collections=[],this.databaseVersion=1.5,this.engineVersion=1.5,this.autosave=!1,this.autosaveInterval=5e3,this.autosaveHandle=null,this.throttledSaves=!0,this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,this.throttledSavePending=!1,this.throttledCallbacks=[],this.verbose=!(!t||!t.hasOwnProperty("verbose"))&&t.verbose,this.events={init:[],loaded:[],flushChanges:[],close:[],changes:[],warning:[]},t&&t.hasOwnProperty("env")?this.ENV=t.env:this.ENV=void 0!==n&&(n.android||n.NSObject)?"NATIVESCRIPT":"undefined"==typeof window?"NODEJS":void 0!==n&&n.window&&i?"NODEJS":"undefined"!=typeof document?-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://")?"CORDOVA":"BROWSER":"CORDOVA","undefined"===this.ENV&&(this.ENV="NODEJS"),this.configureOptions(t,!0),this.on("init",this.clearChanges)}function w(e){this.hashStore={},this.options=e||{},this.options.hasOwnProperty("asyncResponses")||(this.options.asyncResponses=!1),this.options.hasOwnProperty("asyncTimeout")||(this.options.asyncTimeout=50)}function x(e,t){if(this.mode="reference",this.adapter=null,this.options=t||{},this.dbref=null,this.dbname="",this.pageIterator={},!e)throw new Error("LokiPartitioningAdapter requires a (non-reference mode) adapter on construction");if("reference"===e.mode)throw new Error("LokiPartitioningAdapter cannot be instantiated with a reference mode adapter");this.adapter=e,this.options.hasOwnProperty("paging")||(this.options.paging=!1),this.options.hasOwnProperty("pageSize")||(this.options.pageSize=26214400),this.options.hasOwnProperty("delimiter")||(this.options.delimiter="$<\n")}function k(){try{this.fs=r(36)}catch(e){this.fs=null}}function O(){}function P(e,t){return t=t||{},this.collection=e,this.filteredrows=[],this.filterInitialized=!1,this}function S(e,t,r){this.collection=e,this.name=t,this.rebuildPending=!1,this.options=r||{},this.options.hasOwnProperty("persistent")||(this.options.persistent=!1),this.options.hasOwnProperty("sortPriority")||(this.options.sortPriority="passive"),this.options.hasOwnProperty("minRebuildInterval")||(this.options.minRebuildInterval=1),this.resultset=new P(e),this.resultdata=[],this.resultsdirty=!1,this.cachedresultset=null,this.filterPipeline=[],this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,this.events={rebuild:[]}}function A(t,r){this.name=t,this.data=[],this.idIndex=[],this.binaryIndices={},this.constraints={unique:{},exact:{}},this.uniqueNames=[],this.transforms={},this.objType=t,this.dirty=!0,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null;var n=this;(r=r||{}).hasOwnProperty("unique")&&(Array.isArray(r.unique)||(r.unique=[r.unique]),r.unique.forEach(function(e){n.uniqueNames.push(e),n.constraints.unique[e]=new N(e)})),r.hasOwnProperty("exact")&&r.exact.forEach(function(e){n.constraints.exact[e]=new F(e)}),this.adaptiveBinaryIndices=!r.hasOwnProperty("adaptiveBinaryIndices")||r.adaptiveBinaryIndices,this.transactional=!!r.hasOwnProperty("transactional")&&r.transactional,this.cloneObjects=!!r.hasOwnProperty("clone")&&r.clone,this.cloneMethod=r.hasOwnProperty("cloneMethod")?r.cloneMethod:"parse-stringify",this.asyncListeners=!!r.hasOwnProperty("asyncListeners")&&r.asyncListeners,this.disableMeta=!!r.hasOwnProperty("disableMeta")&&r.disableMeta,this.disableChangesApi=!r.hasOwnProperty("disableChangesApi")||r.disableChangesApi,this.disableDeltaChangesApi=!r.hasOwnProperty("disableDeltaChangesApi")||r.disableDeltaChangesApi,this.disableChangesApi&&(this.disableDeltaChangesApi=!0),this.autoupdate=!!r.hasOwnProperty("autoupdate")&&r.autoupdate,this.serializableIndices=!r.hasOwnProperty("serializableIndices")||r.serializableIndices,this.ttl={age:null,ttlInterval:null,daemon:null},this.setTTL(r.ttl||-1,r.ttlInterval),this.maxId=0,this.DynamicViews=[],this.events={insert:[],update:[],"pre-insert":[],"pre-update":[],close:[],flushbuffer:[],error:[],delete:[],warning:[]},this.changes=[],this.ensureId();var i=[];if(r&&r.indices)if("[object Array]"===Object.prototype.toString.call(r.indices))i=r.indices;else{if("string"!=typeof r.indices)throw new TypeError("Indices needs to be a string or an array of strings");i=[r.indices]}for(var o=0;o<i.length;o++)this.ensureIndex(i[o]);function s(e,t){var r=null!==t&&"object"==(void 0===t?"undefined":a(t))?Object.keys(t):null;if(r&&r.length&&["string","boolean","number"].indexOf(void 0===t?"undefined":a(t))<0){for(var i={},o=0;o<r.length;o++){var u=r[o];if(t.hasOwnProperty(u))if(!e.hasOwnProperty(u)||n.uniqueNames.indexOf(u)>=0||"$loki"==u||"meta"==u)i[u]=t[u];else{var c=s(e[u],t[u]);void 0!==c&&c!={}&&(i[u]=c)}}return 0===Object.keys(i).length?void 0:i}return e===t?void 0:t}function u(){n.changes=[]}this.observerCallback=function(t){var r="function"==typeof Set?new Set:[];r.add||(r.add=function(e){return-1===this.indexOf(e)&&this.push(e),this}),t.forEach(function(e){r.add(e.object)}),r.forEach(function(t){if(!e.call(t,"$loki"))return n.removeAutoUpdateObserver(t);try{n.update(t)}catch(e){}})},this.getChangeDelta=function(e,t){return t?s(t,e):JSON.parse(JSON.stringify(e))},this.getObjectDelta=s,this.getChanges=function(){return n.changes},this.flushChanges=u,this.setChangesApi=function(e){n.disableChangesApi=!e,e||(n.disableDeltaChangesApi=!1)},this.on("delete",function(e){n.disableChangesApi||n.createChange(n.name,"R",e)}),this.on("warning",function(e){n.console.warn(e)}),u()}function I(e){return-1!==e.indexOf(".")}function E(e){return parseFloat(e,10)}function R(e,t){return e+t}function C(e,t){return e-t}function j(e){return e.reduce(R,0)/e.length}function _(e,t,r){if(!1===r)return e[t];for(var n=t.split("."),i=e;n.length>0;)i=i[n.shift()];return i}function D(e,t,r){for(var n,i,o=0,a=e.length;o<a;){if(i=o+a>>1,0===(n=r.apply(null,[t,e[i]])))return{found:!0,index:i};n<0?a=i:o=i+1}return{found:!1,index:a}}function M(e){return function(t,r){return D(t,r,e)}}function T(){}function N(e){this.field=e,this.keyMap={},this.lokiMap={}}function F(e){this.index={},this.field=e}return g.prototype.events={},g.prototype.asyncListeners=!1,g.prototype.on=function(e,t){var r,n=this;return Array.isArray(e)?(e.forEach(function(e){n.on(e,t)}),t):((r=this.events[e])||(r=this.events[e]=[]),r.push(t),t)},g.prototype.emit=function(e){var t=this,r=Array.prototype.slice.call(arguments,1);if(!e||!this.events[e])throw new Error("No event "+e+" defined");this.events[e].forEach(function(e){t.asyncListeners?setTimeout(function(){e.apply(t,r)},1):e.apply(t,r)})},g.prototype.addListener=g.prototype.on,g.prototype.removeListener=function(e,t){var r=this;if(Array.isArray(e))e.forEach(function(e){r.removeListener(e,t)});else if(this.events[e]){var n=this.events[e];n.splice(n.indexOf(t),1)}},b.prototype=new g,b.prototype.constructor=b,b.prototype.getIndexedAdapter=function(){return r(21)},b.prototype.configureOptions=function(e,t){var r={fs:k,localStorage:O,memory:w};if(this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,void 0!==e){if(this.options=e,this.options.hasOwnProperty("persistenceMethod")&&"function"==typeof r[e.persistenceMethod]&&(this.persistenceMethod=e.persistenceMethod,this.persistenceAdapter=new r[e.persistenceMethod]),this.options.hasOwnProperty("adapter")&&(this.persistenceMethod="adapter",this.persistenceAdapter=e.adapter,this.options.adapter=null),e.autoload&&t){var n=this;setTimeout(function(){n.loadDatabase(e,e.autoloadCallback)},1)}this.options.hasOwnProperty("autosaveInterval")&&(this.autosaveDisable(),this.autosaveInterval=parseInt(this.options.autosaveInterval,10)),this.options.hasOwnProperty("autosave")&&this.options.autosave&&(this.autosaveDisable(),this.autosave=!0,this.options.hasOwnProperty("autosaveCallback")?this.autosaveEnable(e,e.autosaveCallback):this.autosaveEnable()),this.options.hasOwnProperty("throttledSaves")&&(this.throttledSaves=this.options.throttledSaves)}this.options.hasOwnProperty("serializationMethod")||(this.options.serializationMethod="normal"),this.options.hasOwnProperty("destructureDelimiter")||(this.options.destructureDelimiter="$<\n"),null===this.persistenceAdapter&&(this.persistenceMethod={NODEJS:"fs",BROWSER:"localStorage",CORDOVA:"localStorage",MEMORY:"memory"}[this.ENV],this.persistenceMethod&&(this.persistenceAdapter=new r[this.persistenceMethod]))},b.prototype.copy=function(e){var t,r,n=new b(this.filename,{env:"NA"});if(e=e||{},n.loadJSONObject(this,{retainDirtyFlags:!0}),e.hasOwnProperty("removeNonSerializable")&&!0===e.removeNonSerializable)for(n.autosaveHandle=null,n.persistenceAdapter=null,t=n.collections.length,r=0;r<t;r++)n.collections[r].constraints=null,n.collections[r].ttl=null;return n},b.prototype.addCollection=function(e,t){var r,n=this.collections.length;if(t&&!0===t.disableMeta){if(!1===t.disableChangesApi)throw new Error("disableMeta option cannot be passed as true when disableChangesApi is passed as false");if(!1===t.disableDeltaChangesApi)throw new Error("disableMeta option cannot be passed as true when disableDeltaChangesApi is passed as false");if("number"==typeof t.ttl&&t.ttl>0)throw new Error("disableMeta option cannot be passed as true when ttl is enabled")}for(r=0;r<n;r+=1)if(this.collections[r].name===e)return this.collections[r];var i=new A(e,t);return this.collections.push(i),this.verbose&&(i.console=console),i},b.prototype.loadCollection=function(e){if(!e.name)throw new Error("Collection must have a name property to be loaded");this.collections.push(e)},b.prototype.getCollection=function(e){var t,r=this.collections.length;for(t=0;t<r;t+=1)if(this.collections[t].name===e)return this.collections[t];return this.emit("warning","collection "+e+" not found"),null},b.prototype.renameCollection=function(e,t){var r=this.getCollection(e);return r&&(r.name=t),r},b.prototype.listCollections=function(){for(var e=this.collections.length,t=[];e--;)t.push({name:this.collections[e].name,type:this.collections[e].objType,count:this.collections[e].data.length});return t},b.prototype.removeCollection=function(e){var t,r=this.collections.length;for(t=0;t<r;t+=1)if(this.collections[t].name===e){var n=new A(e,{}),i=this.collections[t];for(var o in i)i.hasOwnProperty(o)&&n.hasOwnProperty(o)&&(i[o]=n[o]);return void this.collections.splice(t,1)}},b.prototype.getName=function(){return this.name},b.prototype.serializeReplacer=function(e,t){switch(e){case"autosaveHandle":case"persistenceAdapter":case"constraints":case"ttl":return null;case"throttledSavePending":case"throttledCallbacks":return;default:return t}},b.prototype.serialize=function(e){switch((e=e||{}).hasOwnProperty("serializationMethod")||(e.serializationMethod=this.options.serializationMethod),e.serializationMethod){case"normal":return JSON.stringify(this,this.serializeReplacer);case"pretty":return JSON.stringify(this,this.serializeReplacer,2);case"destructured":return this.serializeDestructured();default:return JSON.stringify(this,this.serializeReplacer)}},b.prototype.toJson=b.prototype.serialize,b.prototype.serializeDestructured=function(e){var t,r,n,i,o,a=[];if((e=e||{}).hasOwnProperty("partitioned")||(e.partitioned=!1),e.hasOwnProperty("delimited")||(e.delimited=!0),e.hasOwnProperty("delimiter")||(e.delimiter=this.options.destructureDelimiter),!0===e.partitioned&&e.hasOwnProperty("partition")&&e.partition>=0)return this.serializeCollection({delimited:e.delimited,delimiter:e.delimiter,collectionIndex:e.partition});for((o=new b(this.filename)).loadJSONObject(this),t=0;t<o.collections.length;t++)o.collections[t].data=[];if(!0===e.partitioned&&-1===e.partition)return o.serialize({serializationMethod:"normal"});for(a.push(o.serialize({serializationMethod:"normal"})),o=null,t=0;t<this.collections.length;t++)if(n=this.serializeCollection({delimited:e.delimited,delimiter:e.delimiter,collectionIndex:t}),!1===e.partitioned&&!1===e.delimited){if(!Array.isArray(n))throw new Error("a nondelimited, non partitioned collection serialization did not return an expected array");for(i=n.length,r=0;r<i;r++)a.push(n[r]),n[r]=null;a.push("")}else a.push(n);return e.partitioned?(e.delimited,a):e.delimited?(a.push(""),a.join(e.delimiter)):(a.push(""),a)},b.prototype.serializeCollection=function(e){var t,r,n=[];if((e=e||{}).hasOwnProperty("delimited")||(e.delimited=!0),!e.hasOwnProperty("collectionIndex"))throw new Error("serializeCollection called without 'collectionIndex' option");for(t=this.collections[e.collectionIndex].data.length,n=[],r=0;r<t;r++)n.push(JSON.stringify(this.collections[e.collectionIndex].data[r]));return e.delimited?(n.push(""),n.join(e.delimiter)):n},b.prototype.deserializeDestructured=function(e,t){var r,n,i,o=[],a=0,s=1,u=!1;if((t=t||{}).hasOwnProperty("partitioned")||(t.partitioned=!1),t.hasOwnProperty("delimited")||(t.delimited=!0),t.hasOwnProperty("delimiter")||(t.delimiter=this.options.destructureDelimiter),t.partitioned){if(t.hasOwnProperty("partition"))return-1===t.partition?r=JSON.parse(e[0]):this.deserializeCollection(e[t.partition+1],t);for(n=(r=JSON.parse(e[0])).collections.length,a=0;a<n;a++)r.collections[a].data=this.deserializeCollection(e[a+1],t);return r}if(t.delimited){if(o=e.split(t.delimiter),e=null,0===o.length)return null}else o=e;for(n=(r=JSON.parse(o[0])).collections.length,o[0]=null;!u;)o[s],""===o[s]?++a>n&&(u=!0):(i=JSON.parse(o[s]),r.collections[a].data.push(i)),o[s++]=null;return r},b.prototype.deserializeCollection=function(e,t){var r,n,i=[];for((t=t||{}).hasOwnProperty("partitioned")||(t.partitioned=!1),t.hasOwnProperty("delimited")||(t.delimited=!0),t.hasOwnProperty("delimiter")||(t.delimiter=this.options.destructureDelimiter),t.delimited?(i=e.split(t.delimiter)).pop():i=e,n=i.length,r=0;r<n;r++)i[r]=JSON.parse(i[r]);return i},b.prototype.loadJSON=function(e,t){var r;if(0===e.length)r={};else switch(this.options.serializationMethod){case"normal":case"pretty":r=JSON.parse(e);break;case"destructured":r=this.deserializeDestructured(e);break;default:r=JSON.parse(e)}this.loadJSONObject(r,t)},b.prototype.loadJSONObject=function(e,r){var n,i,o,a,s,u,c=0,l=e.collections?e.collections.length:0;function f(e){var n,i=r[e.name];return i.proto?(n=i.inflate||t.copyProperties,function(e){var t=new i.proto;return n(e,t),t}):i.inflate}for(this.name=e.name,e.hasOwnProperty("throttledSaves")&&r&&!r.hasOwnProperty("throttledSaves")&&(this.throttledSaves=e.throttledSaves),this.collections=[];c<l;c+=1){if(n=e.collections[c],(i=this.addCollection(n.name,{disableChangesApi:n.disableChangesApi,disableDeltaChangesApi:n.disableDeltaChangesApi,disableMeta:n.disableMeta})).adaptiveBinaryIndices=!!n.hasOwnProperty("adaptiveBinaryIndices")&&!0===n.adaptiveBinaryIndices,i.transactional=n.transactional,i.asyncListeners=n.asyncListeners,i.cloneObjects=n.cloneObjects,i.cloneMethod=n.cloneMethod||"parse-stringify",i.autoupdate=n.autoupdate,i.changes=n.changes,r&&!0===r.retainDirtyFlags?i.dirty=n.dirty:i.dirty=!1,o=n.data.length,a=0,r&&r.hasOwnProperty(n.name))for(s=f(n);a<o;a++)u=s(n.data[a]),i.data[a]=u,i.addAutoUpdateObserver(u);else for(;a<o;a++)i.data[a]=n.data[a],i.addAutoUpdateObserver(i.data[a]);if(i.maxId=void 0===n.maxId?0:n.maxId,i.idIndex=n.idIndex,void 0!==n.binaryIndices&&(i.binaryIndices=n.binaryIndices),void 0!==n.transforms&&(i.transforms=n.transforms),i.ensureId(),i.uniqueNames=[],n.hasOwnProperty("uniqueNames"))for(i.uniqueNames=n.uniqueNames,a=0;a<i.uniqueNames.length;a++)i.ensureUniqueIndex(i.uniqueNames[a]);if(void 0!==n.DynamicViews){for(var d=0;d<n.DynamicViews.length;d++){var h=n.DynamicViews[d],p=i.addDynamicView(h.name,h.options);p.resultdata=h.resultdata,p.resultsdirty=h.resultsdirty,p.filterPipeline=h.filterPipeline,p.sortCriteria=h.sortCriteria,p.sortFunction=null,p.sortDirty=h.sortDirty,p.resultset.filteredrows=h.resultset.filteredrows,p.resultset.filterInitialized=h.resultset.filterInitialized,p.rematerialize({removeWhereFilters:!0})}e.databaseVersion<1.5&&(i.ensureAllIndexes(!0),i.dirty=!0)}}},b.prototype.close=function(e){this.autosave&&(this.autosaveDisable(),this.autosaveDirty()&&(this.saveDatabase(e),e=void 0)),e&&this.on("close",e),this.emit("close")},b.prototype.generateChangesNotification=function(e){function t(e){return e.name}var r=[],n=e||this.collections.map(t);return this.collections.forEach(function(e){-1!==n.indexOf(t(e))&&(r=r.concat(e.getChanges()))}),r},b.prototype.serializeChanges=function(e){return JSON.stringify(this.generateChangesNotification(e))},b.prototype.clearChanges=function(){this.collections.forEach(function(e){e.flushChanges&&e.flushChanges()})},w.prototype.loadDatabase=function(e,t){var r=this;this.options.asyncResponses?setTimeout(function(){r.hashStore.hasOwnProperty(e)?t(r.hashStore[e].value):t(null)},this.options.asyncTimeout):this.hashStore.hasOwnProperty(e)?t(this.hashStore[e].value):t(null)},w.prototype.saveDatabase=function(e,t,r){var n,i=this;this.options.asyncResponses?setTimeout(function(){n=i.hashStore.hasOwnProperty(e)?i.hashStore[e].savecount:0,i.hashStore[e]={savecount:n+1,lastsave:new Date,value:t},r()},this.options.asyncTimeout):(n=this.hashStore.hasOwnProperty(e)?this.hashStore[e].savecount:0,this.hashStore[e]={savecount:n+1,lastsave:new Date,value:t},r())},w.prototype.deleteDatabase=function(e,t){this.hashStore.hasOwnProperty(e)&&delete this.hashStore[e],"function"==typeof t&&t()},x.prototype.loadDatabase=function(e,t){var r=this;this.dbname=e,this.dbref=new b(e),this.adapter.loadDatabase(e,function(e){if(e){"string"!=typeof e&&t(new Error("LokiPartitioningAdapter received an unexpected response from inner adapter loadDatabase()"));var n=JSON.parse(e);r.dbref.loadJSONObject(n),n=null,r.dbref.collections.length,0!==r.dbref.collections.length?(r.pageIterator={collection:0,pageIndex:0},r.loadNextPartition(0,function(){t(r.dbref)})):t(r.dbref)}else t(e)})},x.prototype.loadNextPartition=function(e,t){var r=this.dbname+"."+e,n=this;if(!0===this.options.paging)return this.pageIterator.pageIndex=0,void this.loadNextPage(t);this.adapter.loadDatabase(r,function(r){var i=n.dbref.deserializeCollection(r,{delimited:!0,collectionIndex:e});n.dbref.collections[e].data=i,++e<n.dbref.collections.length?n.loadNextPartition(e,t):t()})},x.prototype.loadNextPage=function(e){var t=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,r=this;this.adapter.loadDatabase(t,function(t){var n=t.split(r.options.delimiter);t="";var i,o=n.length,a=""===n[o-1];for(a&&(n.pop(),""===n[(o=n.length)-1]&&1===o&&(n.pop(),o=n.length)),i=0;i<o;i++)r.dbref.collections[r.pageIterator.collection].data.push(JSON.parse(n[i])),n[i]=null;n=[],a?++r.pageIterator.collection<r.dbref.collections.length?r.loadNextPartition(r.pageIterator.collection,e):e():(r.pageIterator.pageIndex++,r.loadNextPage(e))})},x.prototype.exportDatabase=function(e,t,r){var n,i=t.collections.length;for(this.dbref=t,this.dbname=e,this.dirtyPartitions=[-1],n=0;n<i;n++)t.collections[n].dirty&&this.dirtyPartitions.push(n);this.saveNextPartition(function(e){r(e)})},x.prototype.saveNextPartition=function(e){var t=this,r=this.dirtyPartitions.shift(),n=this.dbname+(-1===r?"":"."+r);if(this.options.paging&&-1!==r)return this.pageIterator={collection:r,docIndex:0,pageIndex:0},void this.saveNextPage(function(r){0===t.dirtyPartitions.length?e(r):t.saveNextPartition(e)});var i=this.dbref.serializeDestructured({partitioned:!0,delimited:!0,partition:r});this.adapter.saveDatabase(n,i,function(r){r?e(r):0===t.dirtyPartitions.length?e(null):t.saveNextPartition(e)})},x.prototype.saveNextPage=function(e){var t=this,r=this.dbref.collections[this.pageIterator.collection],n=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,i=0,o=r.data.length,a=this.options.delimiter.length,s="",u="",c=!1,l=!1,f=function(r){u="",r&&e(r),c?e(null):(t.pageIterator.pageIndex++,t.saveNextPage(e))};for(0===r.data.length&&(c=!0);;)if(c||(s=JSON.stringify(r.data[this.pageIterator.docIndex]),u+=s,i+=s.length,++this.pageIterator.docIndex>=o&&(c=!0)),i>=this.options.pageSize&&(l=!0),l&&!c||(u+=this.options.delimiter,i+=a),c||l)return void this.adapter.saveDatabase(n,u,f)},k.prototype.loadDatabase=function(e,t){var r=this;this.fs.stat(e,function(n,i){!n&&i.isFile()?r.fs.readFile(e,{encoding:"utf8"},function(e,r){t(e?new Error(e):r)}):t(null)})},k.prototype.saveDatabase=function(e,t,r){var n=this,i=e+"~";this.fs.writeFile(i,t,function(t){t?r(new Error(t)):n.fs.rename(i,e,r)})},k.prototype.deleteDatabase=function(e,t){this.fs.unlink(e,function(e){e?t(new Error(e)):t()})},O.prototype.loadDatabase=function(e,t){y()?t(localStorage.getItem(e)):t(new Error("localStorage is not available"))},O.prototype.saveDatabase=function(e,t,r){y()?(localStorage.setItem(e,t),r(null)):r(new Error("localStorage is not available"))},O.prototype.deleteDatabase=function(e,t){y()?(localStorage.removeItem(e),t(null)):t(new Error("localStorage is not available"))},b.prototype.throttledSaveDrain=function(e,t){var r=this,n=(new Date).getTime();if(this.throttledSaves||e(!0),(t=t||{}).hasOwnProperty("recursiveWait")||(t.recursiveWait=!0),t.hasOwnProperty("recursiveWaitLimit")||(t.recursiveWaitLimit=!1),t.hasOwnProperty("recursiveWaitLimitDuration")||(t.recursiveWaitLimitDuration=2e3),t.hasOwnProperty("started")||(t.started=(new Date).getTime()),this.throttledSaves&&this.throttledSavePending){if(!t.recursiveWait)return void this.throttledCallbacks.push(e);this.throttledCallbacks.push(function(){return r.throttledSavePending?t.recursiveWaitLimit&&n-t.started>t.recursiveWaitLimitDuration?void e(!1):void r.throttledSaveDrain(e,t):void e(!0)})}else e(!0)},b.prototype.loadDatabaseInternal=function(e,t){var r=t||function(e,t){if(e)throw e},n=this;null!==this.persistenceAdapter?this.persistenceAdapter.loadDatabase(this.filename,function(t){if("string"==typeof t){var i=!1;try{n.loadJSON(t,e||{}),i=!0}catch(e){r(e)}i&&(r(null),n.emit("loaded","database "+n.filename+" loaded"))}else{if(!t)return r(null),void n.emit("loaded","empty database "+n.filename+" loaded");if(t instanceof Error)return void r(t);if("object"==(void 0===t?"undefined":a(t)))return n.loadJSONObject(t,e||{}),r(null),void n.emit("loaded","database "+n.filename+" loaded");r("unexpected adapter response : "+t)}}):r(new Error("persistenceAdapter not configured"))},b.prototype.loadDatabase=function(e,t){var r=this;this.throttledSaves?this.throttledSaveDrain(function(n){if(n)return r.throttledSavePending=!0,void r.loadDatabaseInternal(e,function(e){0===r.throttledCallbacks.length?r.throttledSavePending=!1:r.saveDatabase(),"function"==typeof t&&t(e)});"function"==typeof t&&t(new Error("Unable to pause save throttling long enough to read database"))},e):this.loadDatabaseInternal(e,t)},b.prototype.saveDatabaseInternal=function(e){var t=e||function(e){if(e)throw e},r=this;null!==this.persistenceAdapter?"reference"===this.persistenceAdapter.mode&&"function"==typeof this.persistenceAdapter.exportDatabase?this.persistenceAdapter.exportDatabase(this.filename,this.copy({removeNonSerializable:!0}),function(e){r.autosaveClearFlags(),t(e)}):(r.autosaveClearFlags(),this.persistenceAdapter.saveDatabase(this.filename,r.serialize(),function(e){t(e)})):t(new Error("persistenceAdapter not configured"))},b.prototype.saveDatabase=function(e){if(this.throttledSaves)if(this.throttledSavePending)this.throttledCallbacks.push(e);else{var t=this.throttledCallbacks;this.throttledCallbacks=[],t.unshift(e),this.throttledSavePending=!0;var r=this;this.saveDatabaseInternal(function(e){r.throttledSavePending=!1,t.forEach(function(t){"function"==typeof t&&setTimeout(function(){t(e)},1)}),r.throttledCallbacks.length>0&&r.saveDatabase()})}else this.saveDatabaseInternal(e)},b.prototype.save=b.prototype.saveDatabase,b.prototype.deleteDatabase=function(e,t){var r=t||function(e,t){if(e)throw e};"function"!=typeof e||t||(r=e),null!==this.persistenceAdapter?this.persistenceAdapter.deleteDatabase(this.filename,function(e){r(e)}):r(new Error("persistenceAdapter not configured"))},b.prototype.autosaveDirty=function(){for(var e=0;e<this.collections.length;e++)if(this.collections[e].dirty)return!0;return!1},b.prototype.autosaveClearFlags=function(){for(var e=0;e<this.collections.length;e++)this.collections[e].dirty=!1},b.prototype.autosaveEnable=function(e,t){this.autosave=!0;var r=5e3,n=this;void 0!==this.autosaveInterval&&null!==this.autosaveInterval&&(r=this.autosaveInterval),this.autosaveHandle=setInterval(function(){n.autosaveDirty()&&n.saveDatabase(t)},r)},b.prototype.autosaveDisable=function(){void 0!==this.autosaveHandle&&null!==this.autosaveHandle&&(clearInterval(this.autosaveHandle),this.autosaveHandle=null)},P.prototype.reset=function(){return this.filteredrows.length>0&&(this.filteredrows=[]),this.filterInitialized=!1,this},P.prototype.toJSON=function(){var e=this.copy();return e.collection=null,e},P.prototype.limit=function(e){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var t=new P(this.collection);return t.filteredrows=this.filteredrows.slice(0,e),t.filterInitialized=!0,t},P.prototype.offset=function(e){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var t=new P(this.collection);return t.filteredrows=this.filteredrows.slice(e),t.filterInitialized=!0,t},P.prototype.copy=function(){var e=new P(this.collection);return this.filteredrows.length>0&&(e.filteredrows=this.filteredrows.slice()),e.filterInitialized=this.filterInitialized,e},P.prototype.branch=P.prototype.copy,P.prototype.transform=function(e,r){var n,i,o=this;if("string"==typeof e&&this.collection.transforms.hasOwnProperty(e)&&(e=this.collection.transforms[e]),"object"!=(void 0===e?"undefined":a(e))||!Array.isArray(e))throw new Error("Invalid transform");for(void 0!==r&&(e=t.resolveTransformParams(e,r)),n=0;n<e.length;n++)switch((i=e[n]).type){case"find":o.find(i.value);break;case"where":o.where(i.value);break;case"simplesort":o.simplesort(i.property,i.desc||i.options);break;case"compoundsort":o.compoundsort(i.value);break;case"sort":o.sort(i.value);break;case"limit":o=o.limit(i.value);break;case"offset":o=o.offset(i.value);break;case"map":o=o.map(i.value,i.dataOptions);break;case"eqJoin":o=o.eqJoin(i.joinData,i.leftJoinKey,i.rightJoinKey,i.mapFun,i.dataOptions);break;case"mapReduce":o=o.mapReduce(i.mapFunction,i.reduceFunction);break;case"update":o.update(i.value);break;case"remove":o.remove()}return o},P.prototype.sort=function(e){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var t=function(e,t){return function(r,n){return e(t[r],t[n])}}(e,this.collection.data);return this.filteredrows.sort(t),this},P.prototype.simplesort=function(e,t){var r,n=10,i=this.collection.data.length,o=this.filteredrows.length,a=this.collection.binaryIndices.hasOwnProperty(e);if(void 0!==t&&!1!==t||(t={desc:!1}),!0===t&&(t={desc:!0}),0===o){if(this.filterInitialized)return this;if(this.collection.binaryIndices.hasOwnProperty(e))return this.collection.ensureIndex(e),this.filteredrows=this.collection.binaryIndices[e].values.slice(0),t.desc&&this.filteredrows.reverse(),this;this.filteredrows=this.collection.prepareFullDocIndex()}else if(!t.disableIndexIntersect&&a&&(r=i/o,t.useJavascriptSorting&&(n=6),r<=n||t.forceIndexIntersect)){var s,u=this.filteredrows,c={};for(s=0;s<o;s++)c[u[s]]=!0;var f=this.collection.binaryIndices[e].values;return this.filteredrows=f.filter(function(e){return c[e]}),t.desc&&this.filteredrows.reverse(),this}if(t.useJavascriptSorting)return this.sort(function(t,r){return t[e]===r[e]?0:t[e]>r[e]?1:t[e]<r[e]?-1:void 0});var d=function(e,t,r){var n,i,o;return function(a,s){return~e.indexOf(".")?(o=e.split("."),n=o.reduce(function(e,t){return e&&e[t]||void 0},r[a]),i=o.reduce(function(e,t){return e&&e[t]||void 0},r[s])):(n=r[a][e],i=r[s][e]),l(n,i,t)}}(e,t.desc,this.collection.data);return this.filteredrows.sort(d),this},P.prototype.compoundsort=function(e){if(0===e.length)throw new Error("Invalid call to compoundsort, need at least one property");var t;if(1===e.length)return t=e[0],Array.isArray(t)?this.simplesort(t[0],t[1]):this.simplesort(t,!1);for(var r=0,n=e.length;r<n;r+=1)t=e[r],Array.isArray(t)||(e[r]=[t,!1]);this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var i=function(e,t){return function(r,n){return function(e,t,r){for(var n,i,o,a,s,u=0,c=0,f=e.length;c<f;c++)if(~(i=(n=e[c])[0]).indexOf(".")?(o=(s=i.split(".")).reduce(function(e,t){return e&&e[t]||void 0},t),a=s.reduce(function(e,t){return e&&e[t]||void 0},r)):(o=t[i],a=r[i]),0!==(u=l(o,a,n[1])))return u;return 0}(e,t[r],t[n])}}(e,this.collection.data);return this.filteredrows.sort(i),this},P.prototype.findOr=function(e){for(var t=null,r=0,n=0,i=[],o=[],a=0,s=this.count(),u=0,c=e.length;u<c;u++){if((n=(t=this.branch().find(e[u]).filteredrows).length)===s)return this;for(r=0;r<n;r++)void 0===o[a=t[r]]&&(o[a]=!0,i.push(a))}return this.filteredrows=i,this.filterInitialized=!0,this},P.prototype.$or=P.prototype.findOr,P.prototype.findAnd=function(e){for(var t=0,r=e.length;t<r;t++){if(0===this.count())return this;this.find(e[t])}return this},P.prototype.$and=P.prototype.findAnd,P.prototype.find=function(t,r){if(0===this.collection.data.length)return this.filteredrows=[],this.filterInitialized=!0,this;var n,i,o,s,u,c,l,d=t||"getAll",h=!1,m=[],y=[],g=null;if(r=r||!1,"object"==(void 0===d?"undefined":a(d))){for(n in d)(s={})[n]=d[n],y.push(s),e.call(d,n)&&(i=n,o=d[n]);if(y.length>1)return this.find({$and:y},r)}if(!i||"getAll"===d)return r&&(this.filteredrows=this.collection.data.length>0?[0]:[],this.filterInitialized=!0),this;if("$and"===i||"$or"===i)return this[i](o),r&&this.filteredrows.length>1&&(this.filteredrows=this.filteredrows.slice(0,1)),this;if(null===o||"object"!=(void 0===o?"undefined":a(o))||o instanceof Date)u="$eq",c=o;else{if("object"!=(void 0===o?"undefined":a(o)))throw new Error("Do not know what you want to do.");for(l in o)if(e.call(o,l)){u=l,c=o[l];break}}"$regex"===u&&(Array.isArray(c)?c=new RegExp(c[0],c[1]):c instanceof RegExp||(c=new RegExp(c)));var b=-1!==i.indexOf(".");!b&&!this.filterInitialized&&this.collection.binaryIndices[i]&&v[u]&&(!0!==this.collection.adaptiveBinaryIndices&&this.collection.ensureIndex(i),h=!0,g=this.collection.binaryIndices[i]);var w,x=p[u],k=this.collection.data,O=0,P=0,S=0;if(this.filterInitialized)if(P=(w=this.filteredrows).length,b)for(i=i.split("."),O=0;O<P;O++)f(k[S=w[O]],i,x,c)&&m.push(S);else for(O=0;O<P;O++)x(k[S=w[O]][i],c)&&m.push(S);else if(h){var A=this.collection.calculateRange(u,i,c);if("$in"!==u){for(O=A[0];O<=A[1];O++)if(!0!==v[u]){if(v[u](k[g.values[O]][i],c)&&(m.push(g.values[O]),r))return this.filteredrows=m,this.filterInitialized=!0,this}else if(m.push(g.values[O]),r)return this.filteredrows=m,this.filterInitialized=!0,this}else for(O=0,P=A.length;O<P;O++)if(m.push(g.values[A[O]]),r)return this.filteredrows=m,this.filterInitialized=!0,this}else if(P=k.length,b){for(i=i.split("."),O=0;O<P;O++)if(f(k[O],i,x,c)&&(m.push(O),r))return this.filteredrows=m,this.filterInitialized=!0,this}else for(O=0;O<P;O++)if(x(k[O][i],c)&&(m.push(O),r))return this.filteredrows=m,this.filterInitialized=!0,this;return this.filteredrows=m,this.filterInitialized=!0,this},P.prototype.where=function(e){var t,r=[];if("function"!=typeof e)throw new TypeError("Argument is not a stored view or a function");t=e;try{if(this.filterInitialized){for(var n=this.filteredrows.length;n--;)!0===t(this.collection.data[this.filteredrows[n]])&&r.push(this.filteredrows[n]);return this.filteredrows=r,this}for(var i=this.collection.data.length;i--;)!0===t(this.collection.data[i])&&r.push(i);return this.filteredrows=r,this.filterInitialized=!0,this}catch(e){throw e}},P.prototype.count=function(){return this.filterInitialized?this.filteredrows.length:this.collection.count()},P.prototype.data=function(e){var t,r,n,i,o=[],a=this.collection.data;if((e=e||{}).removeMeta&&!e.forceClones&&(e.forceClones=!0,e.forceCloneMethod=e.forceCloneMethod||"shallow"),this.collection.disableDeltaChangesApi||(e.forceClones=!0,e.forceCloneMethod="parse-stringify"),!this.filterInitialized){if(0===this.filteredrows.length){if(this.collection.cloneObjects||e.forceClones){for(r=a.length,i=e.forceCloneMethod||this.collection.cloneMethod,n=0;n<r;n++)t=m(a[n],i),e.removeMeta&&(delete t.$loki,delete t.meta),o.push(t);return o}return a.slice()}this.filterInitialized=!0}var s=this.filteredrows;if(r=s.length,this.collection.cloneObjects||e.forceClones)for(i=e.forceCloneMethod||this.collection.cloneMethod,n=0;n<r;n++)t=m(a[s[n]],i),e.removeMeta&&(delete t.$loki,delete t.meta),o.push(t);else for(n=0;n<r;n++)o.push(a[s[n]]);return o},P.prototype.update=function(e){if("function"!=typeof e)throw new TypeError("Argument is not a function");this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());for(var t,r=this.filteredrows.length,n=this.collection.data,i=0;i<r;i++)this.collection.cloneObjects||!this.collection.disableDeltaChangesApi?(e(t=m(n[this.filteredrows[i]],this.collection.cloneMethod)),this.collection.update(t)):(e(n[this.filteredrows[i]]),this.collection.update(n[this.filteredrows[i]]));return this},P.prototype.remove=function(){return this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex()),this.collection.removeBatchByPositions(this.filteredrows),this.filteredrows=[],this},P.prototype.mapReduce=function(e,t){try{return t(this.data().map(e))}catch(e){throw e}},P.prototype.eqJoin=function(e,t,r,n,i){var o,a,s,u,c=[],l=[],f="function"==typeof t,d="function"==typeof r,h={};if(o=(u=this.data(i)).length,e instanceof A)c=e.chain().data(i);else if(e instanceof P)c=e.data(i);else{if(!Array.isArray(e))throw new TypeError("joinData needs to be an array or result set");c=e}a=c.length;for(var p=0;p<a;p++)h[s=d?r(c[p]):c[p][r]]=c[p];n||(n=function(e,t){return{left:e,right:t}});for(var v=0;v<o;v++)s=f?t(u[v]):u[v][t],l.push(n(u[v],h[s]||{}));return this.collection=new A("joinData"),this.collection.insert(l),this.filteredrows=[],this.filterInitialized=!1,this},P.prototype.map=function(e,t){var r=this.data(t).map(e);return this.collection=new A("mappedData"),this.collection.insert(r),this.filteredrows=[],this.filterInitialized=!1,this},S.prototype=new g,S.prototype.rematerialize=function(e){var t,r,n;if(e=e||{},this.resultdata=[],this.resultsdirty=!0,this.resultset=new P(this.collection),(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple)&&(this.sortDirty=!0),e.hasOwnProperty("removeWhereFilters"))for(r=t=this.filterPipeline.length;r--;)"where"===this.filterPipeline[r].type&&(r!==this.filterPipeline.length-1&&(this.filterPipeline[r]=this.filterPipeline[this.filterPipeline.length-1]),this.filterPipeline.length--);var i=this.filterPipeline;for(this.filterPipeline=[],t=i.length,n=0;n<t;n++)this.applyFind(i[n].val);return this.data(),this.emit("rebuild",this),this},S.prototype.branchResultset=function(e,t){var r=this.resultset.branch();return void 0===e?r:r.transform(e,t)},S.prototype.toJSON=function(){var e=new S(this.collection,this.name,this.options);return e.resultset=this.resultset,e.resultdata=[],e.resultsdirty=!0,e.filterPipeline=this.filterPipeline,e.sortFunction=this.sortFunction,e.sortCriteria=this.sortCriteria,e.sortCriteriaSimple=this.sortCriteriaSimple||null,e.sortDirty=this.sortDirty,e.collection=null,e},S.prototype.removeFilters=function(e){e=e||{},this.rebuildPending=!1,this.resultset.reset(),this.resultdata=[],this.resultsdirty=!0,this.cachedresultset=null,this.filterPipeline=[],this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,!0===e.queueSortPhase&&this.queueSortPhase()},S.prototype.applySort=function(e){return this.sortFunction=e,this.sortCriteria=null,this.sortCriteriaSimple=null,this.queueSortPhase(),this},S.prototype.applySimpleSort=function(e,t){return this.sortCriteriaSimple={propname:e,options:t||!1},this.sortCriteria=null,this.sortFunction=null,this.queueSortPhase(),this},S.prototype.applySortCriteria=function(e){return this.sortCriteria=e,this.sortCriteriaSimple=null,this.sortFunction=null,this.queueSortPhase(),this},S.prototype.startTransaction=function(){return this.cachedresultset=this.resultset.copy(),this},S.prototype.commit=function(){return this.cachedresultset=null,this},S.prototype.rollback=function(){return this.resultset=this.cachedresultset,this.options.persistent&&(this.resultdata=this.resultset.data(),this.emit("rebuild",this)),this},S.prototype._indexOfFilterWithId=function(e){if("string"==typeof e||"number"==typeof e)for(var t=0,r=this.filterPipeline.length;t<r;t+=1)if(e===this.filterPipeline[t].uid)return t;return-1},S.prototype._addFilter=function(e){this.filterPipeline.push(e),this.resultset[e.type](e.val)},S.prototype.reapplyFilters=function(){this.resultset.reset(),this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0);var e=this.filterPipeline;this.filterPipeline=[];for(var t=0,r=e.length;t<r;t+=1)this._addFilter(e[t]);return this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this},S.prototype.applyFilter=function(e){var t=this._indexOfFilterWithId(e.uid);return t>=0?(this.filterPipeline[t]=e,this.reapplyFilters()):(this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0),this._addFilter(e),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this)},S.prototype.applyFind=function(e,t){return this.applyFilter({type:"find",val:e,uid:t}),this},S.prototype.applyWhere=function(e,t){return this.applyFilter({type:"where",val:e,uid:t}),this},S.prototype.removeFilter=function(e){var t=this._indexOfFilterWithId(e);if(t<0)throw new Error("Dynamic view does not contain a filter with ID: "+e);return this.filterPipeline.splice(t,1),this.reapplyFilters(),this},S.prototype.count=function(){return this.resultsdirty&&(this.resultdata=this.resultset.data()),this.resultset.count()},S.prototype.data=function(e){return(this.sortDirty||this.resultsdirty)&&this.performSortPhase({suppressRebuildEvent:!0}),this.options.persistent?this.resultdata:this.resultset.data(e)},S.prototype.queueRebuildEvent=function(){if(!this.rebuildPending){this.rebuildPending=!0;var e=this;setTimeout(function(){e.rebuildPending&&(e.rebuildPending=!1,e.emit("rebuild",e))},this.options.minRebuildInterval)}},S.prototype.queueSortPhase=function(){if(!this.sortDirty){this.sortDirty=!0;var e=this;"active"===this.options.sortPriority?setTimeout(function(){e.performSortPhase()},this.options.minRebuildInterval):this.queueRebuildEvent()}},S.prototype.performSortPhase=function(e){(this.sortDirty||this.resultsdirty)&&(e=e||{},this.sortDirty&&(this.sortFunction?this.resultset.sort(this.sortFunction):this.sortCriteria?this.resultset.compoundsort(this.sortCriteria):this.sortCriteriaSimple&&this.resultset.simplesort(this.sortCriteriaSimple.propname,this.sortCriteriaSimple.options),this.sortDirty=!1),this.options.persistent&&(this.resultdata=this.resultset.data(),this.resultsdirty=!1),e.suppressRebuildEvent||this.emit("rebuild",this))},S.prototype.evaluateDocument=function(e,t){if(!this.resultset.filterInitialized)return this.options.persistent&&(this.resultdata=this.resultset.data()),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());var r,n=this.resultset.filteredrows,i=t?-1:n.indexOf(+e),o=n.length,a=new P(this.collection);a.filteredrows=[e],a.filterInitialized=!0;for(var s=0,u=this.filterPipeline.length;s<u;s++)a[(r=this.filterPipeline[s]).type](r.val);var c=0===a.filteredrows.length?-1:0;return-1!==i||-1!==c?-1===i&&-1!==c?(n.push(e),this.options.persistent&&this.resultdata.push(this.collection.data[e]),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):-1!==i&&-1===c?(i<o-1?(n.splice(i,1),this.options.persistent&&this.resultdata.splice(i,1)):(n.length=o-1,this.options.persistent&&(this.resultdata.length=o-1)),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):-1!==i&&-1!==c?(this.options.persistent&&(this.resultdata[i]=this.collection.data[e]),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):void 0:void 0},S.prototype.removeDocument=function(e){var t,r,n,i={},o={},a=[],s=this.resultset,u=this.resultset.filteredrows,c=u.length;if(!this.resultset.filterInitialized)return this.options.persistent&&(this.resultdata=this.resultset.data()),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());for(Array.isArray(e)||(e=[e]),n=e.length,r=0;r<n;r++)i[e[r]]=!0;for(t=0;t<c;t++)i[u[t]]&&(o[t]=!0);Object.keys(o).length>0&&(this.resultset.filteredrows=this.resultset.filteredrows.filter(function(e,t){return!o[t]}),this.options.persistent&&(this.resultdata=this.resultdata.filter(function(e,t){return!o[t]})),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());var l=function(e){return function(t){return t<s.filteredrows[e]}};for(c=s.filteredrows.length,t=0;t<c;t++)a=e.filter(l(t)),s.filteredrows[t]-=a.length},S.prototype.mapReduce=function(e,t){try{return t(this.data().map(e))}catch(e){throw e}},A.prototype=new g,A.prototype.createChange=function(e,t,r,n){this.changes.push({name:e,operation:t,obj:"U"!=t||this.disableDeltaChangesApi?JSON.parse(JSON.stringify(r)):this.getChangeDelta(r,n)})},A.prototype.insertMeta=function(e){var t,r;if(!this.disableMeta&&e)if(Array.isArray(e))for(t=e.length,r=0;r<t;r++)e[r].hasOwnProperty("meta")||(e[r].meta={}),e[r].meta.created=(new Date).getTime(),e[r].meta.revision=0;else e.meta||(e.meta={}),e.meta.created=(new Date).getTime(),e.meta.revision=0},A.prototype.updateMeta=function(e){!this.disableMeta&&e&&(e.meta.updated=(new Date).getTime(),e.meta.revision+=1)},A.prototype.createInsertChange=function(e){this.createChange(this.name,"I",e)},A.prototype.createUpdateChange=function(e,t){this.createChange(this.name,"U",e,t)},A.prototype.insertMetaWithChange=function(e){this.insertMeta(e),this.createInsertChange(e)},A.prototype.updateMetaWithChange=function(e,t){this.updateMeta(e),this.createUpdateChange(e,t)},A.prototype.console={log:function(){},warn:function(){},error:function(){}},A.prototype.addAutoUpdateObserver=function(e){this.autoupdate&&"function"==typeof Object.observe&&Object.observe(e,this.observerCallback,["add","update","delete","reconfigure","setPrototype"])},A.prototype.removeAutoUpdateObserver=function(e){this.autoupdate&&"function"==typeof Object.observe&&Object.unobserve(e,this.observerCallback)},A.prototype.addTransform=function(e,t){if(this.transforms.hasOwnProperty(e))throw new Error("a transform by that name already exists");this.transforms[e]=t},A.prototype.getTransform=function(e){return this.transforms[e]},A.prototype.setTransform=function(e,t){this.transforms[e]=t},A.prototype.removeTransform=function(e){delete this.transforms[e]},A.prototype.byExample=function(e){var t,r,n;for(t in n=[],e)e.hasOwnProperty(t)&&n.push(((r={})[t]=e[t],r));return{$and:n}},A.prototype.findObject=function(e){return this.findOne(this.byExample(e))},A.prototype.findObjects=function(e){return this.find(this.byExample(e))},A.prototype.ttlDaemonFuncGen=function(){var e=this,t=this.ttl.age;return function(){var r=Date.now();e.chain().where(function(e){var n=e.meta.updated||e.meta.created;return t<r-n}).remove()}},A.prototype.setTTL=function(e,t){e<0?clearInterval(this.ttl.daemon):(this.ttl.age=e,this.ttl.ttlInterval=t,this.ttl.daemon=setInterval(this.ttlDaemonFuncGen(),t))},A.prototype.prepareFullDocIndex=function(){for(var e=this.data.length,t=new Array(e),r=0;r<e;r+=1)t[r]=r;return t},A.prototype.configureOptions=function(e){(e=e||{}).hasOwnProperty("adaptiveBinaryIndices")&&(this.adaptiveBinaryIndices=e.adaptiveBinaryIndices,this.adaptiveBinaryIndices&&this.ensureAllIndexes())},A.prototype.ensureIndex=function(e,t){if(void 0===t&&(t=!1),null===e||void 0===e)throw new Error("Attempting to set index without an associated property");if((!this.binaryIndices[e]||t||this.binaryIndices[e].dirty)&&(!0!==this.adaptiveBinaryIndices||!this.binaryIndices.hasOwnProperty(e)||t)){var r={name:e,dirty:!0,values:this.prepareFullDocIndex()};this.binaryIndices[e]=r;var n=function(e,t){var r,n,i;return function(a,s){if(~e.indexOf(".")?(i=e.split("."),r=i.reduce(function(e,t){return e&&e[t]||void 0},t[a]),n=i.reduce(function(e,t){return e&&e[t]||void 0},t[s])):(r=t[a][e],n=t[s][e]),r!==n){if(o.lt(r,n,!1))return-1;if(o.gt(r,n,!1))return 1}return 0}}(e,this.data);r.values.sort(n),r.dirty=!1,this.dirty=!0}},A.prototype.checkAllIndexes=function(t){var r,n=this.binaryIndices,i=[];for(r in n)e.call(n,r)&&(this.checkIndex(r,t)||i.push(r));return i},A.prototype.checkIndex=function(e,t){(t=t||{}).randomSamplingFactor&&!1!==t.randomSampling&&(t.randomSampling=!0),t.randomSamplingFactor=t.randomSamplingFactor||.1,(t.randomSamplingFactor<0||t.randomSamplingFactor>1)&&(t.randomSamplingFactor=.1);var r,n,i,o,a,s=!0;if(!this.binaryIndices.hasOwnProperty(e))throw new Error("called checkIndex on property without an index: "+e);if(this.adaptiveBinaryIndices||this.ensureIndex(e),(o=(a=this.binaryIndices[e].values).length)!==this.data.length)return t.repair&&this.ensureIndex(e,!0),!1;if(0===o)return!0;if(1===o)s=0===a[0];else if(t.randomSampling){if(p.$lte(this.data[a[0]][e],this.data[a[1]][e])||(s=!1),p.$lte(this.data[a[o-2]][e],this.data[a[o-1]][e])||(s=!1),s)for(n=Math.floor((o-1)*t.randomSamplingFactor),r=0;r<n-1;r++)if(i=Math.floor(Math.random()*(o-1)),!p.$lte(this.data[a[i]][e],this.data[a[i+1]][e])){s=!1;break}}else for(r=0;r<o-1;r++)if(!p.$lte(this.data[a[r]][e],this.data[a[r+1]][e])){s=!1;break}return!s&&t.repair&&this.ensureIndex(e,!0),s},A.prototype.getBinaryIndexValues=function(e){var t,r=this.binaryIndices[e].values,n=[];for(t=0;t<r.length;t++)n.push(this.data[r[t]][e]);return n},A.prototype.ensureUniqueIndex=function(e){var t=this.constraints.unique[e];return t||-1==this.uniqueNames.indexOf(e)&&this.uniqueNames.push(e),this.constraints.unique[e]=t=new N(e),this.data.forEach(function(e){t.set(e)}),t},A.prototype.ensureAllIndexes=function(t){var r,n=this.binaryIndices;for(r in n)e.call(n,r)&&this.ensureIndex(r,t)},A.prototype.flagBinaryIndexesDirty=function(){var t,r=this.binaryIndices;for(t in r)e.call(r,t)&&(r[t].dirty=!0)},A.prototype.flagBinaryIndexDirty=function(e){this.binaryIndices[e]&&(this.binaryIndices[e].dirty=!0)},A.prototype.count=function(e){return e?this.chain().find(e).filteredrows.length:this.data.length},A.prototype.ensureId=function(){var e=this.data.length,t=0;for(this.idIndex=[];t<e;t+=1)this.idIndex.push(this.data[t].$loki)},A.prototype.ensureIdAsync=function(e){this.async(function(){this.ensureId()},e)},A.prototype.addDynamicView=function(e,t){var r=new S(this,e,t);return this.DynamicViews.push(r),r},A.prototype.removeDynamicView=function(e){for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].name===e&&this.DynamicViews.splice(t,1)},A.prototype.getDynamicView=function(e){for(var t=0;t<this.DynamicViews.length;t++)if(this.DynamicViews[t].name===e)return this.DynamicViews[t];return null},A.prototype.findAndUpdate=function(e,t){"function"==typeof e?this.updateWhere(e,t):this.chain().find(e).update(t)},A.prototype.findAndRemove=function(e){this.chain().find(e).remove()},A.prototype.insert=function(e){if(!Array.isArray(e))return this.insertOne(e);var t,r=[];this.emit("pre-insert",e);for(var n=0,i=e.length;n<i;n++){if(!(t=this.insertOne(e[n],!0)))return;r.push(t)}return this.emit("insert",r),1===(r=this.cloneObjects?m(r,this.cloneMethod):r).length?r[0]:r},A.prototype.insertOne=function(e,t){var r,n=null;if("object"!=(void 0===e?"undefined":a(e))?n=new TypeError("Document needs to be an object"):null===e&&(n=new TypeError("Object cannot be null")),null!==n)throw this.emit("error",n),n;var i=this.cloneObjects?m(e,this.cloneMethod):e;if(this.disableMeta||void 0!==i.meta||(i.meta={revision:0,created:0}),t||this.emit("pre-insert",i),this.add(i))return this.disableChangesApi?this.insertMeta(i):this.insertMetaWithChange(i),r=this.cloneObjects?m(i,this.cloneMethod):i,t||this.emit("insert",r),this.addAutoUpdateObserver(r),r},A.prototype.clear=function(e){var t=this;(e=e||{},this.data=[],this.idIndex=[],this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null,this.maxId=0,this.DynamicViews=[],this.dirty=!0,!0===e.removeIndices)?(this.binaryIndices={},this.constraints={unique:{},exact:{}},this.uniqueNames=[]):(Object.keys(this.binaryIndices).forEach(function(e){t.binaryIndices[e].dirty=!1,t.binaryIndices[e].values=[]}),this.constraints={unique:{},exact:{}},this.uniqueNames.forEach(function(e){t.ensureUniqueIndex(e)}))},A.prototype.update=function(t){var r,n,i;if(Array.isArray(t)){i=t.length,(r=!this.cloneObjects&&this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0)&&(this.adaptiveBinaryIndices=!1);try{for(n=0;n<i;n+=1)this.update(t[n])}finally{r&&(this.ensureAllIndexes(),this.adaptiveBinaryIndices=!0)}}else{if(!e.call(t,"$loki"))throw new Error("Trying to update unsynced document. Please save the document first by using insert() or addMany()");try{this.startTransaction();var o,a,s,u,c,l=this.get(t.$loki,!0),f=this;if(!l)throw new Error("Trying to update a document not in collection.");o=l[0],s=l[1],a=this.cloneObjects||!this.disableDeltaChangesApi?m(t,this.cloneMethod):t,this.emit("pre-update",t),Object.keys(this.constraints.unique).forEach(function(e){f.constraints.unique[e].update(o,a)}),this.data[s]=a,a!==t&&this.addAutoUpdateObserver(t);for(var d=0;d<this.DynamicViews.length;d++)this.DynamicViews[d].evaluateDocument(s,!1);if(this.adaptiveBinaryIndices){var h=this.binaryIndices;for(u in h)this.adaptiveBinaryIndexUpdate(s,u)}else this.flagBinaryIndexesDirty();return this.idIndex[s]=a.$loki,this.commit(),this.dirty=!0,this.disableChangesApi?this.updateMeta(a,null):this.updateMetaWithChange(a,o),c=this.cloneObjects?m(a,this.cloneMethod):a,this.emit("update",c,o),c}catch(e){throw this.rollback(),this.console.error(e.message),this.emit("error",e),e}}},A.prototype.add=function(t){if("object"!=(void 0===t?"undefined":a(t)))throw new TypeError("Object being added needs to be an object");if(void 0!==t.$loki)throw new Error("Document is already in collection, please use update()");try{this.startTransaction(),this.maxId++,isNaN(this.maxId)&&(this.maxId=this.data[this.data.length-1].$loki+1),t.$loki=this.maxId,this.disableMeta||(t.meta.version=0);var r,n=this.constraints.unique;for(r in n)e.call(n,r)&&n[r].set(t);this.idIndex.push(t.$loki),this.data.push(t);for(var i=this.data.length-1,o=this.DynamicViews.length,s=0;s<o;s++)this.DynamicViews[s].evaluateDocument(i,!0);if(this.adaptiveBinaryIndices){var u=this.binaryIndices;for(r in u)this.adaptiveBinaryIndexInsert(i,r)}else this.flagBinaryIndexesDirty();return this.commit(),this.dirty=!0,this.cloneObjects?m(t,this.cloneMethod):t}catch(e){throw this.rollback(),this.console.error(e.message),this.emit("error",e),e}},A.prototype.updateWhere=function(e,t){var r,n=this.where(e),i=0;try{for(;i<n.length;i++)r=t(n[i]),this.update(r)}catch(e){this.rollback(),this.console.error(e.message)}},A.prototype.removeWhere=function(e){var t;"function"==typeof e?(t=this.data.filter(e),this.remove(t)):this.chain().find(e).remove()},A.prototype.removeDataOnly=function(){this.remove(this.data.slice())},A.prototype.removeBatchByPositions=function(e){var t,r,n,i,o=e.length,a={},s=Object.keys(this.binaryIndices).length,u=Object.keys(this.constraints.unique).length,c=this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0,l=this;try{for(this.startTransaction(),n=0;n<o;n++)a[this.idIndex[e[n]]]=!0;if((t=this.DynamicViews.length)>0||s>0||u>0){if(t>0)for(r=0;r<t;r++)this.DynamicViews[r].removeDocument(e);if(this.adaptiveBinaryIndices&&!c){var f,d=this.binaryIndices;for(f in d)this.adaptiveBinaryIndexRemove(e,f)}else this.flagBinaryIndexesDirty();u&&Object.keys(this.constraints.unique).forEach(function(t){for(n=0;n<o;n++)null!==(i=l.data[e[n]])[t]&&void 0!==i[t]&&l.constraints.unique[t].remove(i[t])})}if(!this.disableChangesApi||this.events.delete.length>1)for(n=0;n<o;n++)this.emit("delete",this.data[e[n]]);this.data=this.data.filter(function(e){return!a[e.$loki]}),this.idIndex=this.idIndex.filter(function(e){return!a[e]}),this.adaptiveBinaryIndices&&c&&(this.adaptiveBinaryIndices=!1,this.ensureAllIndexes(!0),this.adaptiveBinaryIndices=!0),this.commit(),this.dirty=!0}catch(e){return this.rollback(),c&&(this.adaptiveBinaryIndices=!0),this.console.error(e.message),this.emit("error",e),null}},A.prototype.removeBatch=function(e){var t,r=e.length,n=this.data.length,i={},o=[];for(t=0;t<n;t++)i[this.data[t].$loki]=t;for(t=0;t<r;t++)"object"==a(e[t])?o.push(i[e[t].$loki]):o.push(i[e[t]]);this.removeBatchByPositions(o)},A.prototype.remove=function(t){if("number"==typeof t&&(t=this.get(t)),"object"!=(void 0===t?"undefined":a(t)))throw new Error("Parameter is not an object");if(Array.isArray(t))this.removeBatch(t);else{if(!e.call(t,"$loki"))throw new Error("Object is not a document stored in the collection");try{this.startTransaction();var r=this.get(t.$loki,!0),n=r[1],i=this;Object.keys(this.constraints.unique).forEach(function(e){null!==t[e]&&void 0!==t[e]&&i.constraints.unique[e].remove(t[e])});for(var o=0;o<this.DynamicViews.length;o++)this.DynamicViews[o].removeDocument(n);if(this.adaptiveBinaryIndices){var s,u=this.binaryIndices;for(s in u)this.adaptiveBinaryIndexRemove(n,s)}else this.flagBinaryIndexesDirty();return this.data.splice(n,1),this.removeAutoUpdateObserver(t),this.idIndex.splice(n,1),this.commit(),this.dirty=!0,this.emit("delete",r[0]),delete t.$loki,delete t.meta,t}catch(e){return this.rollback(),this.console.error(e.message),this.emit("error",e),null}}},A.prototype.get=function(e,t){var r=t||!1,n=this.idIndex,i=n.length-1,o=0,a=o+i>>1;if(e="number"==typeof e?e:parseInt(e,10),isNaN(e))throw new TypeError("Passed id is not an integer");for(;n[o]<n[i];)n[a=o+i>>1]<e?o=a+1:i=a;return i===o&&n[o]===e?r?[this.data[o],o]:this.data[o]:null},A.prototype.getBinaryIndexPosition=function(e,t){var r=this.data[e][t],n=this.binaryIndices[t].values,i=this.calculateRange("$eq",t,r);if(0===i[0]&&-1===i[1])return null;for(var o=i[0],a=i[1],s=o;s<=a;s++)if(n[s]===e)return s;return null},A.prototype.adaptiveBinaryIndexInsert=function(e,t){var r=this.binaryIndices[t].values,n=this.data[e][t];!0===this.serializableIndices&&n instanceof Date&&(this.data[e][t]=n.getTime(),n=this.data[e][t]);var i=0===r.length?0:this.calculateRangeStart(t,n,!0);this.binaryIndices[t].values.splice(i,0,e)},A.prototype.adaptiveBinaryIndexUpdate=function(e,t){var r,n=this.binaryIndices[t].values,i=n.length;for(r=0;r<i&&n[r]!==e;r++);this.binaryIndices[t].values.splice(r,1),this.adaptiveBinaryIndexInsert(e,t)},A.prototype.adaptiveBinaryIndexRemove=function(e,t,r){var n,i,o,a,s,u,c,l=this.binaryIndices[t],f={};if(Array.isArray(e)){if(1!==(a=e.length)){for(o=0;o<a;o++)f[e[o]]=!0;if(l.values=l.values.filter(function(e){return!f[e]}),!0===r)return;var d=e.slice();for(d.sort(function(e,t){return e-t}),n=l.values.length,i=0;i<n;i++){for(s=l.values[i],u=0,o=0;o<a&&s>d[o];o++)u++;l.values[i]-=u}return}e=e[0]}if(null===(c=this.getBinaryIndexPosition(e,t)))return null;if(l.values.splice(c,1),!0!==r)for(n=l.values.length,i=0;i<n;i++)l.values[i]>e&&l.values[i]--},A.prototype.calculateRangeStart=function(e,t,r){var n=this.data,i=this.binaryIndices[e].values,a=0,s=i.length-1,u=0;if(0===i.length)return-1;for(n[i[a]][e],n[i[s]][e];a<s;)u=a+s>>1,o.lt(n[i[u]][e],t,!1)?a=u+1:s=u;var c=a;return o.aeq(t,n[i[c]][e])?c:o.lt(t,n[i[c]][e],!1)?r?c:c-1:r?c+1:c},A.prototype.calculateRangeEnd=function(e,t){var r=this.data,n=this.binaryIndices[e].values,i=0,a=n.length-1,s=0;if(0===n.length)return-1;for(r[n[i]][e],r[n[a]][e];i<a;)s=i+a>>1,o.lt(t,r[n[s]][e],!1)?a=s:i=s+1;var u=a;return o.aeq(t,r[n[u]][e])?u:o.gt(t,r[n[u]][e],!1)?u+1:o.aeq(t,r[n[u-1]][e])?u-1:u},A.prototype.calculateRange=function(e,t,r){var n,i,a,s=this.data,u=this.binaryIndices[t].values,c=u.length-1;if(0===s.length)return[0,-1];var l=s[u[0]][t],f=s[u[c]][t];switch(e){case"$eq":case"$aeq":case"$dteq":if(o.lt(r,l,!1)||o.gt(r,f,!1))return[0,-1];break;case"$gt":if(o.gt(r,f,!0))return[0,-1];if(o.gt(l,r,!1))return[0,c];break;case"$gte":if(o.gt(r,f,!1))return[0,-1];if(o.gt(l,r,!0))return[0,c];break;case"$lt":if(o.lt(r,l,!0))return[0,-1];if(o.lt(f,r,!1))return[0,c];break;case"$lte":if(o.lt(r,l,!1))return[0,-1];if(o.lt(f,r,!0))return[0,c];break;case"$between":return o.gt(r[0],f,!1)?[0,-1]:o.lt(r[1],l,!1)?[0,-1]:(n=this.calculateRangeStart(t,r[0]),a=this.calculateRangeEnd(t,r[1]),n<0&&n++,a>c&&a--,o.gt(s[u[n]][t],r[0],!0)||n++,o.lt(s[u[a]][t],r[1],!0)||a--,a<n?[0,-1]:[n,a]);case"$in":for(var d=[],h=[],p=0,v=r.length;p<v;p++)for(var m=this.calculateRange("$eq",t,r[p]),y=m[0];y<=m[1];y++)void 0===d[y]&&(d[y]=!0,h.push(y));return h}switch(e){case"$eq":case"$aeq":case"$dteq":case"$gte":case"$lt":i=s[u[n=this.calculateRangeStart(t,r)]][t]}switch(e){case"$eq":case"$aeq":case"$dteq":case"$lte":case"$gt":s[u[a=this.calculateRangeEnd(t,r)]][t]}switch(e){case"$eq":case"$aeq":case"$dteq":return o.aeq(i,r)?[n,a]:[0,-1];case"$gt":return o.aeq(s[u[a]][t],r)?[a+1,c]:[a,c];case"$gte":return o.aeq(s[u[n]][t],r)?[n,c]:[n+1,c];case"$lt":return o.aeq(s[u[n]][t],r)?[0,n-1]:[0,n];case"$lte":return o.aeq(s[u[a]][t],r)?[0,a]:[0,a-1];default:return[0,s.length-1]}},A.prototype.by=function(e,t){var r;if(void 0===t)return r=this,function(t){return r.by(e,t)};var n=this.constraints.unique[e].get(t);return this.cloneObjects?m(n,this.cloneMethod):n},A.prototype.findOne=function(e){e=e||{};var t=this.chain().find(e,!0).data();return Array.isArray(t)&&0===t.length?null:this.cloneObjects?m(t[0],this.cloneMethod):t[0]},A.prototype.chain=function(e,t){var r=new P(this);return void 0===e?r:r.transform(e,t)},A.prototype.find=function(e){return this.chain().find(e).data()},A.prototype.findOneUnindexed=function(e,t){for(var r=this.data.length;r--;)if(this.data[r][e]===t)return this.data[r];return null},A.prototype.startTransaction=function(){if(this.transactional){this.cachedData=m(this.data,this.cloneMethod),this.cachedIndex=this.idIndex,this.cachedBinaryIndex=this.binaryIndices;for(var e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].startTransaction()}},A.prototype.commit=function(){if(this.transactional){this.cachedData=null,this.cachedIndex=null,this.cachedBinaryIndex=null;for(var e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].commit()}},A.prototype.rollback=function(){if(this.transactional){null!==this.cachedData&&null!==this.cachedIndex&&(this.data=this.cachedData,this.idIndex=this.cachedIndex,this.binaryIndices=this.cachedBinaryIndex);for(var e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].rollback()}},A.prototype.async=function(e,t){setTimeout(function(){if("function"!=typeof e)throw new TypeError("Argument passed for async execution is not a function");e(),t()},0)},A.prototype.where=function(e){return this.chain().where(e).data()},A.prototype.mapReduce=function(e,t){try{return t(this.data.map(e))}catch(e){throw e}},A.prototype.eqJoin=function(e,t,r,n,i){return new P(this).eqJoin(e,t,r,n,i)},A.prototype.stages={},A.prototype.getStage=function(e){return this.stages[e]||(this.stages[e]={}),this.stages[e]},A.prototype.commitLog=[],A.prototype.stage=function(e,t){var r=JSON.parse(JSON.stringify(t));return this.getStage(e)[t.$loki]=r,r},A.prototype.commitStage=function(e,t){var r,n=this.getStage(e),i=(new Date).getTime();for(r in n)this.update(n[r]),this.commitLog.push({timestamp:i,message:t,data:JSON.parse(JSON.stringify(n[r]))});this.stages[e]={}},A.prototype.no_op=function(){},A.prototype.extract=function(e){for(var t=0,r=this.data.length,n=I(e),i=[];t<r;t+=1)i.push(_(this.data[t],e,n));return i},A.prototype.max=function(e){return Math.max.apply(null,this.extract(e))},A.prototype.min=function(e){return Math.min.apply(null,this.extract(e))},A.prototype.maxRecord=function(e){for(var t,r=0,n=this.data.length,i=I(e),o={index:0,value:void 0};r<n;r+=1)void 0!==t?t<_(this.data[r],e,i)&&(t=_(this.data[r],e,i),o.index=this.data[r].$loki):(t=_(this.data[r],e,i),o.index=this.data[r].$loki);return o.value=t,o},A.prototype.minRecord=function(e){for(var t,r=0,n=this.data.length,i=I(e),o={index:0,value:void 0};r<n;r+=1)void 0!==t?t>_(this.data[r],e,i)&&(t=_(this.data[r],e,i),o.index=this.data[r].$loki):(t=_(this.data[r],e,i),o.index=this.data[r].$loki);return o.value=t,o},A.prototype.extractNumerical=function(e){return this.extract(e).map(E).filter(Number).filter(function(e){return!isNaN(e)})},A.prototype.avg=function(e){return j(this.extractNumerical(e))},A.prototype.stdDev=function(e){return function(e){var t=j(e),r=j(e.map(function(e){var r=e-t;return r*r}));return Math.sqrt(r)}(this.extractNumerical(e))},A.prototype.mode=function(e){var t,r,n,i={},o=this.extract(e);for(r in o.forEach(function(e){i[e]?i[e]+=1:i[e]=1}),i)t?t<i[r]&&(n=r):(n=r,t=i[r]);return n},A.prototype.median=function(e){var t=this.extractNumerical(e);t.sort(C);var r=Math.floor(t.length/2);return t.length%2?t[r]:(t[r-1]+t[r])/2},T.prototype={keys:[],values:[],sort:function(e,t){return e<t?-1:e>t?1:0},setSort:function(e){this.bs=new M(e)},bs:function(){return new M(this.sort)},set:function(e,t){var r=this.bs(this.keys,e);r.found?this.values[r.index]=t:(this.keys.splice(r.index,0,e),this.values.splice(r.index,0,t))},get:function(e){return this.values[D(this.keys,e,this.sort).index]}},N.prototype.keyMap={},N.prototype.lokiMap={},N.prototype.set=function(e){var t=e[this.field];if(null!==t&&void 0!==t){if(this.keyMap[t])throw new Error("Duplicate key for property "+this.field+": "+t);this.keyMap[t]=e,this.lokiMap[e.$loki]=t}},N.prototype.get=function(e){return this.keyMap[e]},N.prototype.byId=function(e){return this.keyMap[this.lokiMap[e]]},N.prototype.update=function(e,t){if(this.lokiMap[e.$loki]!==t[this.field]){var r=this.lokiMap[e.$loki];this.set(t),this.keyMap[r]=void 0}else this.keyMap[e[this.field]]=t},N.prototype.remove=function(e){var t=this.keyMap[e];if(null===t||void 0===t)throw new Error("Key is not in unique index: "+this.field);this.keyMap[e]=void 0,this.lokiMap[t.$loki]=void 0},N.prototype.clear=function(){this.keyMap={},this.lokiMap={}},F.prototype={set:function(e,t){this.index[e]?this.index[e].push(t):this.index[e]=[t]},remove:function(e,t){var r=this.index[e];for(var n in r)r[n]==t&&r.splice(n,1);r.length<1&&(this.index[e]=void 0)},get:function(e){return this.index[e]},clear:function(e){this.index={}}},b.LokiOps=p,b.Collection=A,b.KeyValueStore=T,b.LokiMemoryAdapter=w,b.LokiPartitioningAdapter=x,b.LokiLocalStorageAdapter=O,b.LokiFsAdapter=k,b.persistenceAdapters={fs:k,localStorage:O},b.aeq=s,b.lt=u,b.gt=c,b.Comparators=o,b}()})?o.apply(t,[]):o)||(e.exports=s)}).call(this,r(20),r(35))},function(e,t){var r,n,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var u,c=[],l=!1,f=-1;function d(){l&&u&&(l=!1,u.length?c=u.concat(c):f=-1,c.length&&h())}function h(){if(!l){var e=s(d);l=!0;for(var t=c.length;t;){for(u=c,c=[];++f<t;)u&&u[f].run();f=-1,t=c.length}u=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function v(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new p(e,t)),1!==c.length||l||s(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t){},function(e,t){var r="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(r){var n=new Uint8Array(16);e.exports=function(){return r(n),n}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},function(e,t){for(var r=[],n=0;n<256;++n)r[n]=(n+256).toString(16).substr(1);e.exports=function(e,t){var n=t||0,i=r;return i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return void 0===e?"undefined":a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":a(e)},i=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=f(r(6)),s=f(r(0)),u=f(r(13)),c=r(1),l=f(r(5));function f(e){return e&&e.__esModule?e:{default:e}}function d(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}t.default=c.Interface.compose({methods:{getToken:function(){return localStorage.getItem("formioToken")},baseUrl:function(){var e=this.connector,t=e.baseUrl,r=e.name;if(!t)throw new Error('You did not provide a baseUrl for the "'+r+'" connector');return t.replace(/\/+$/,"")},get:function(){var e=this;return d(regeneratorRuntime.mark(function t(){var r,n,a,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.ownerEmail&&e.andWhere("owner","=",e.ownerEmail),r=void 0,n=void 0,t.next=5,(0,o.default)(e.httpGET());case 5:if(a=t.sent,s=i(a,2),r=s[0],n=s[1],!r){t.next=12;break}throw console.log(r),new Error("Error while getting submissions");case 12:return n=e.jsApplySelect(n.data),n=e.jsApplyOrderBy(n),t.abrupt("return",n);case 15:case"end":return t.stop()}},t,e)}))()},all:function(){var e=this;return d(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.get());case 1:case"end":return t.stop()}},t,e)}))()},insert:function(e,t){var r=this;return d(regeneratorRuntime.mark(function n(){var a,s,u,c;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!Array.isArray(e)){n.next=2;break}return n.abrupt("return",r.ArrayInsert(e,t));case 2:return n.next=4,(0,o.default)(r.httpPOST(e));case 4:if(a=n.sent,s=i(a,2),u=s[0],c=s[1],!u){n.next=11;break}throw console.log(u),new Error("Cannot insert data");case 11:return n.abrupt("return",c.data);case 12:case"end":return n.stop()}},n,r)}))()},update:function(e){var t=this;return d(regeneratorRuntime.mark(function r(){var n,a,s,u;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(e._id){r.next=2;break}throw new Error("Formio connector error. Cannot update a Model without _id key");case 2:if(!e._id.includes("_local")){r.next=4;break}throw new Error("Formio connector error. Cannot update a local document");case 4:return r.next=6,(0,o.default)(t.httpPUT(e));case 6:if(n=r.sent,a=i(n,2),s=a[0],u=a[1],!s){r.next=13;break}throw console.log(s),new Error("Cannot insert data");case 13:return r.abrupt("return",u.data);case 14:case"end":return r.stop()}},r,t)}))()},clear:function(){var e=this;return d(regeneratorRuntime.mark(function t(){var r,n,a,s,c,l=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).sure;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(l&&!0===l){t.next=2;break}throw new Error('Clear() method will delete everything!, you must set the "sure" parameter "clear({sure:true})" to continue');case 2:return r=[],t.next=5,(0,o.default)(e.select("_id").pluck("_id"));case 5:if(n=t.sent,a=i(n,2),s=a[0],c=a[1],!s){t.next=12;break}throw console.log(s),new Error("Cannot get remote Model");case 12:return c.forEach(function(t){r.push(e.httpDelete(t))}),t.abrupt("return",u.default.all(r));case 14:case"end":return t.stop()}},t,e)}))()},remove:function(e){var t=this;return d(regeneratorRuntime.mark(function r(){var n,a,s,u;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,o.default)(t.httpDelete(e));case 2:if(n=r.sent,a=i(n,2),s=a[0],u=a[1],!s){r.next=9;break}throw console.log(s),new Error("FormioConnector: Could not delete "+e);case 9:return r.abrupt("return",u);case 10:case"end":return r.stop()}},r,t)}))()},find:function(e){var t=this;return d(regeneratorRuntime.mark(function r(){var a,s,u,c;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if("string"==typeof e){r.next=2;break}throw new Error('Formio connector find() method only accepts strings "'+(void 0===e?"undefined":n(e))+'" given "'+e+'"');case 2:return r.next=4,(0,o.default)(t.where("_id","=",e).first());case 4:if(a=r.sent,s=i(a,2),u=s[0],c=s[1],!u){r.next=11;break}throw console.log(u),new Error("Find() could not get remote data");case 11:return r.abrupt("return",c);case 12:case"end":return r.stop()}},r,t)}))()},getUrl:function(){var e=this,t=this&&this.baseUrl()?this.baseUrl():void 0,r=s.default.get(function(){return e.remoteConnection.path},void 0),n=s.default.get(function(){return e.remoteConnection.id},void 0);if(!s.default.get(function(){return e.remoteConnection.pullForm},void 0)&&r&&(r=n?r+"/submission/"+n:r+"/submission"),!t)throw new Error("Cannot get remote model. baseUrl not defined");return r?t+"/"+r:t},getHeaders:function(){var e={},t=localStorage.getItem("formioToken");return(this.remoteConnection.token||""===this.remoteConnection.token)&&(t=this.remoteConnection.token),t?(e[this.getTokenType(t)]=t,e):e},getSpacer:function(e){return"&"===e.substr(e.length-1)?"":"&"},httpGET:function(){var e=this.getUrl(),t=this.getHeaders(),r=this.getFilters(),n=this.getLimit(),i=this.getSkip(),o=this.getSelect();if(e=e+""+n,e=r?e+this.getSpacer(e)+r:e,e=i?e+this.getSpacer(e)+i:e,e=o?e+this.getSpacer(e)+o:e,!l.default.isOnline())throw new Error("Cannot make get request to "+e+".You are not online");return u.default.get(e,{headers:t})},httpPOST:function(e){var t=this.getUrl(),r=this.getHeaders();if(!l.default.isOnline())throw new Error("Cannot make request post to "+t+".You are not online");return u.default.post(t,e,{headers:r})},httpPUT:function(e){var t=this.getUrl()+"/"+e._id,r=this.getHeaders();if(!l.default.isOnline())throw new Error("Cannot make request post to "+t+".You are not online");return u.default.put(t,e,{headers:r})},httpDelete:function(e){var t=this.getHeaders(),r=this.getUrl()+"/"+e;return u.default.delete(r,{headers:t})},getTokenType:function(e){return e.length>32?"x-jwt-token":"x-token"},getFilters:function(){var e=this.whereArray;if(e&&0!==e.length){var t="";return e.forEach(function(e){var r="",n=e[0],i=e[1],o=e[2];switch(i){case"=":t=t+n+"="+o+"&";break;case"!=":t=t+n+"__ne="+o+"&";break;case">":t=t+n+"__gt="+o+"&";break;case">=":t=t+n+"__gte="+o+"&";break;case"<":t=t+n+"__lt="+o+"&";break;case"<=":t=t+n+"__lte="+o+"&";break;case"in":r="",o.forEach(function(e,t,n){r=t===n.length-1?r+e:r+e+","}),t=t+n+"__in="+r+"&";break;case"nin":r="",o.forEach(function(e,t,n){r=t===n.length-1?r+e:r+e+","}),t=t+n+"__nin="+r+"&";break;case"exists":t=t+n+"__exists="+!0+"&";break;case"!exists":t=t+n+"__exists="+!1+"&";break;case"regex":t=t+n+"__regex="+o+"&"}}),t.substring(0,t.length-1)}},getLimit:function(){return this.limitNumber&&0!==this.limitNumber||(this.limitNumber=50),"?limit="+this.limitNumber},getSkip:function(){return this.offsetNumber||(this.offsetNumber=0),"skip="+this.offsetNumber},getSelect:function(){var e=this.selectArray;if(e=e.map(function(e){return e.split(" as ")[0]}))return"select="+e.join(",")}}})},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(1);t.default=n.Interface.compose({properties:{localFx:void 0,remoteFx:void 0},init:function(e){this.connectors=e},methods:{get:function(){var e=this;return function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}(regeneratorRuntime.mark(function t(){var r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.prepareMergedFunctions(),t.next=3,e.localFx.get();case 3:return r=t.sent,t.next=6,e.remoteFx.get();case 6:return n=t.sent,t.abrupt("return",r.concat(n));case 8:case"end":return t.stop()}},t,e)}))()},prepareMergedFunctions:function(){var e=this;this.localFx=this.connectors.local,this.remoteFx=this.connectors.remote,this.chainReference.forEach(function(t){var r=t.method,n=t.args;e.localFx=e.localFx[r](n),e.remoteFx=e.remoteFx[r](n)})}}})},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(r(3)),o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"setLocales",value:function(){i.default.locale(e.getLenguage())}},{key:"changeLanguage",value:function(e){i.default.locale(e)}},{key:"getLenguage",value:function(){return localStorage.getItem("defaultLenguage")?localStorage.getItem("defaultLenguage"):"en"}}]),e}();t.default=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=u(r(22)),o=u(r(0)),a=u(r(8)),s=u(r(7));function u(e){return e&&e.__esModule?e:{default:e}}function c(e){return function(){var t=e.apply(this,arguments);return new s.default(function(e,r){return function n(i,o){try{var a=t[i](o),u=a.value}catch(e){return void r(e)}if(!a.done)return s.default.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});e(u)}("next")})}}var l=function(){var e=function(){var e=c(regeneratorRuntime.mark(function e(t){var n,i=t.submission,o=t.vm;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!f(n=l(i))){e.next=3;break}return e.abrupt("return",Object.assign({},u(o),{groupId:n}));case 3:return e.abrupt("return",Object.assign({},r(o),{groupId:n}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t=function(){var e=c(regeneratorRuntime.mark(function e(t){var r=t.submission,n=t.vm,i=t.info;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!f(l(r))){e.next=3;break}return e.abrupt("return",h({submission:r,vm:n,info:i}));case 3:return e.abrupt("return",d({submission:r,vm:n,info:i}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}();function r(e){return{progressSteps:["1","2","3"],steps:[{title:e.$t("Group Name"),text:e.$t("Give the group a name"),inputValidator:function(t){return new s.default(function(r,n){""!==t?r():n(new Error(e.$t("The group name is already taken")))})}},{title:e.$t("Current Participant Name"),text:e.$t("Give the current participant a name")},{title:e.$t("Next participant Name"),text:e.$t("Give the next participant a name")}]}}function u(e){return{progressSteps:["1"],steps:[{title:e.$t("Participant Name"),text:e.$t("Give the next participant a name")}]}}function l(e){return o.default.get(function(){return(0,a.default)("*").local().getParallelSurvey(e).groupId})}function f(e){return e}function d(e){var t=e.submission,r=e.vm,o=e.info,s=o[0],u=o[1],c=o[2],l={groupId:(0,i.default)(),groupName:s,participantName:u,submissionId:t._id};return r.currentSubmission.data.parallelSurvey=(0,a.default)("*").local().setParallelSurvey(l),{parallelSurvey:(0,a.default)("*").local().setParallelSurvey(n({},l,{participantName:c}))}}function h(e){var t=e.submission,r=(e.vm,e.info[0]),n=(0,a.default)("*").local().getParallelSurvey(t);return n.participantName=r,{parallelSurvey:(0,a.default)("*").local().setParallelSurvey(n)}}return Object.freeze({createWizard:e,createNewSurvey:t})}();t.default=l},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=s(r(8)),o=s(r(9)),a=s(r(7));function s(e){return e&&e.__esModule?e:{default:e}}function u(e){return function(){var t=e.apply(this,arguments);return new a.default(function(e,r){return function n(i,o){try{var s=t[i](o),u=s.value}catch(e){return void r(e)}if(!s.done)return a.default.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});e(u)}("next")})}}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"fromJsonFile",value:function(t,r){var n=new FileReader;n.onload=function(t){var n=void 0;try{n=JSON.parse(t.target.result)}catch(e){throw new Error("The Json file could not be parsed")}e.parseJson(n,r)},n.readAsText(t)}},{key:"parseJson",value:function(){var t=u(regeneratorRuntime.mark(function t(r,n){var i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i=e.getFormIOInstance(n),a.default.each(r,function(){var t=u(regeneratorRuntime.mark(function t(r,o){var a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.prepareSubmission(r),t.next=3,e.saveSubmission(a,i,n);case 3:case"end":return t.stop()}},t,this)}));return function(e,r){return t.apply(this,arguments)}}()).then(function(){o.default.emit({name:"FAST:DATA:IMPORTED",data:{imported:!0},text:"Data was imported"})}).catch(function(e){console.log(e),n.$swal(n.$t("Import Error!"),n.$t("Your submission could not be Imported. Please check the format of your Json file."),"error")});case 2:case"end":return t.stop()}},t,this)}));return function(e,r){return t.apply(this,arguments)}}()},{key:"emitNotification",value:function(e){e.$eventHub.emit("FAST-DATA_IMPORTED")}},{key:"prepareSubmission",value:function(e){return(e.id||e._id)&&(delete e.id,delete e._id),e.modified&&delete e.modified,e.owner&&delete e.owner,{data:e.data?e.data:e,redirect:!1,syncError:!1,draft:!0,trigger:"importSubmission"}}},{key:"saveSubmission",value:function(){var e=u(regeneratorRuntime.mark(function e(t,r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,i.default)("*").add({submission:t,formio:r});case 2:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()}]),e}();t.default=c},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(r(45));function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"get",value:function(){var e=this;return{priority:0,preRequest:function(){var t=o(regeneratorRuntime.mark(function t(r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("GET"!==r.method){e.next=2;break}return e.abrupt("return",i.default.handle(r));case 2:case"end":return e.stop()}},t,e)}));return function(e){return t.apply(this,arguments)}}(),request:function(){var t=o(regeneratorRuntime.mark(function t(r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("GET"!==r.method){e.next=2;break}return e.abrupt("return",i.default.handle(r));case 2:case"end":return e.stop()}},t,e)}));return function(e){return t.apply(this,arguments)}}(),staticRequest:function(){var t=o(regeneratorRuntime.mark(function t(r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("GET"!==r.method){e.next=2;break}return e.abrupt("return",i.default.handle(r));case 2:case"end":return e.stop()}},t,e)}));return function(e){return t.apply(this,arguments)}}()}}}]),e}();t.default=a},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(r(4));function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"handle",value:function(){var t=o(regeneratorRuntime.mark(function t(r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(-1!==r.url.indexOf("form.io")){t.next=2;break}return t.abrupt("return",e.handleExternalAPI(r));case 2:if("form"!==r.type){t.next=4;break}return t.abrupt("return",e.handleLocalForm(r));case 4:if("select"!==r.type||-1===r.url.indexOf("form.io")){t.next=6;break}return t.abrupt("return",e.handleInternalResource(r));case 6:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"handleExternalAPI",value:function(){return null}},{key:"handleLocalForm",value:function(){var e=o(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.default.local().where("data.path","=",t.formio.formId).first();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"handleInternalResource",value:function(){var e=o(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 4:if(e.sent.filter(function(e){return void 0===e.data._id})[0]){e.next=8;break}return e.abrupt("return");case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();t.default=a},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=a(r(17)),o=a(r(2));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"string",value:function(){var e=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.default.local().first();case 2:return r=e.sent,n="",n=(0,i.default)(t,r.MD5_KEY),e.abrupt("return",n);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();t.default=s}])})}).call(this,r(6)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}}])});
//# sourceMappingURL=fluent-grapesjs.min.js.map